import{_ as u,r as e,o as l,c as k,a as n,b as a,w as o,F as i,d as s,e as c}from"./app.9f6dcb37.js";const r={},m=n("h1",{id:"rudziu-paketas-libmdbx",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#rudziu-paketas-libmdbx","aria-hidden":"true"},"#"),s(" R\u016Bd\u017Ei\u0173 paketas libmdbx")],-1),d=n("code",null,"rust",-1),b=s(),y={href:"https://github.com/erthink/libmdbx",target:"_blank",rel:"noopener noreferrer"},g=s("libmdbx"),f=s(" duomen\u0173 baz\u0117s apvalkalas."),_=n("hr",null,null,-1),w=n("p",null,"Katalogas :",-1),h={class:"table-of-contents"},v=s("Citatos"),x=s("Kas yra libmdbx?"),q=s("Pamokos"),D=s("Kaip paleisti pavyzd\u012F"),E=s("1 pavyzdys : ra\u0161ymas set(key,val) ir skaitymas .get(key)"),B=s("Kodas"),T=s("Paleisti i\u0161vest\u012F"),M=s("Kodo apra\u0161ymas"),j=s("env_rw! Duomen\u0173 baz\u0117s apibr\u0117\u017Eimas"),N=s("Makroaplinkos pl\u0117tra"),z=s("anyhow ir lazy_static"),S=s("Makro mdbx!"),X=s("Si\u016Blai ir sandoriai"),R=s("Dvejetaini\u0173 duomen\u0173 skaitymas ir ra\u0161ymas"),C=s("2 pavyzdys: Duomen\u0173 tipai, duomen\u0173 baz\u0117s \u017Eymos, i\u0161trynimas, nar\u0161ymas"),O=s("Kodas"),V=s("Paleisti i\u0161vest\u012F"),I=s("Greitas skaitymas ir ra\u0161ymas"),P=s("Duomen\u0173 tipai"),U=s("I\u0161 anksto nustatyti duomen\u0173 tipai"),A=s("Duomen\u0173 baz\u0117s v\u0117liavos"),L=s("DUPSORT : vienas raktas atitinka daugiau nei vien\u0105 reik\u0161m\u0119"),F=s(".dup(key) iteratorius, kuris gr\u0105\u017Eina visas rakt\u0105 atitinkan\u010Dias reik\u0161mes."),$=s("Numatytuoju atveju automati\u0161kai pridedamos duomen\u0173 baz\u0117s v\u0117liav\u0117l\u0117s"),G=s("Duomen\u0173 \u0161alinimas"),K=s(".del(key) Klavi\u0161o pa\u0161alinimas"),Y=s(".del_val(key,val) Tikslaus atitikmens i\u0161trynimas"),H=s("Nar\u0161ymas"),J=s("nuoseklioji ap\u017Ei\u016Bra"),W=s(".rev() Atvirk\u0161tin\u0117s tvarkos nar\u0161ymas"),Q=s("R\u016B\u0161iavimas"),Z=s("Intervaliniai iteratoriai"),nn=s("Paleiskite i\u0161vest\u012F"),sn=s(".range(begin..end) Intervalo iteracija"),an=s(".rev_range Apversti intervalai"),tn=s("Duomen\u0173 tip\u0173 pritaikymas"),pn=s("Pasirinktini\u0173 tip\u0173 supaprastinimas naudojant atribut\u0173 makrokomandas"),on=s("Pastaba d\u0117l naudojimo"),cn=s("Rakto ilgis"),en=s("Pastabos"),un=n("hr",null,null,-1),ln=n("h2",{id:"citatos",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#citatos","aria-hidden":"true"},"#"),s(" Citatos")],-1),kn=s("Ra\u0161ydamas "),rn={href:"https://rmw.link",target:"_blank",rel:"noopener noreferrer"},mn=s('"rmw.link'),dn=s(' " pajutau, kad man reikia \u012Fterptosios duomen\u0173 baz\u0117s.'),bn=n("p",null,[s("D\u0117l tinklo pralaidumo, susijusio su da\u017Enu \u012Fra\u0161ymu, skaitymu ir ra\u0161ymu, "),n("code",null,"sqlite3"),s(" buvo per daug pa\u017Eeng\u0119s na\u0161umo po\u017Ei\u016Briu.")],-1),yn=s("Taigi \u017Eemesnio lygio rakt\u0173 ir ver\u010Di\u0173 duomen\u0173 baz\u0117 buvo tinkamesn\u0117 "),gn={href:"https://discourse.world/h/2020/06/05/Shine-and-poverty-key-value-database-LMDB-in-applications-for-iOS",target:"_blank",rel:"noopener noreferrer"},fn=s("(lmdb yra 10 kart\u0173 greitesn\u0117 u\u017E sqlite"),_n=s(" )."),wn=n("p",null,[n("img",{src:"//irmw.gumlet.io/yxZV8x.jpg",alt:""})],-1),hn=n("p",null,[s("Galiausiai pasirinkau stebukling\u0105j\u0105 "),n("code",null,"lmdb"),s(" versij\u0105 - "),n("code",null,"mdbx"),s(".")],-1),vn=s("\u0160iuo metu esamas "),xn=n("code",null,"rust",-1),qn=s(" paketas "),Dn={href:"https://github.com/vorot93/mdbx-rs/issues/1",target:"_blank",rel:"noopener noreferrer"},En=s("mdbx-rs (mdbx-sys"),Bn=s(" ) i\u0161 "),Tn=n("code",null,"mdbx",-1),Mn=s(),jn={href:"https://github.com/vorot93/mdbx-rs/issues/1",target:"_blank",rel:"noopener noreferrer"},Nn=s('nepalaiko "Windows"'),zn=s(', tod\u0117l \u0117miausi kurti paketo versij\u0105 su "Windows" palaikymu.'),Sn=c(`<p>Pasirinktini\u0173 r\u016Bd\u017Ei\u0173 tip\u0173 saugojimo palaikymas. Palaikoma daugiasluoksn\u0117 prieiga.</p><p>Duomen\u0173 baz\u0119 galima apibr\u0117\u017Eti modulyje naudojant <code>lazy_static</code>, o tada j\u0105 tiesiog \u012Fvesti ir naudoti su pvz:</p><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="kas-yra-libmdbx" tabindex="-1"><a class="header-anchor" href="#kas-yra-libmdbx" aria-hidden="true">#</a> Kas yra libmdbx?</h2>`,4),Xn={href:"https://github.com/erthink/libmdbx",target:"_blank",rel:"noopener noreferrer"},Rn=s("mdbx"),Cn=s(" - tai antrin\u0117 duomen\u0173 baz\u0117, sukurta remiantis rus\u0173 autoriaus "),On={href:"https://vk.com/erthink",target:"_blank",rel:"noopener noreferrer"},Vn=s("Leonido Jurjevo (\u041B\u0435\u043E\u043D\u0438\u0434 \u042E\u0440\u044C\u0435\u0432"),In=s(" ) sukurta lmdb."),Pn={href:"https://en.wikipedia.org/wiki/Lightning_Memory-Mapped_Database",target:"_blank",rel:"noopener noreferrer"},Un=s("lmdb"),An=s(" yra itin greita \u012Fterptin\u0117 rakto ir vert\u0117s duomen\u0173 baz\u0117."),Ln=s('Viso teksto paie\u0161kos sistema " '),Fn={href:"https://docs.meilisearch.com/reference/under_the_hood/storage.html#measured-disk-usage",target:"_blank",rel:"noopener noreferrer"},$n=s('MeiliSearch"'),Gn=s(" pagr\u012Fsta lmdb."),Kn={href:"https://docs.nvidia.com/deeplearning/dali/user-guide/docs/examples/general/data_loading/dataloading_lmdb.html",target:"_blank",rel:"noopener noreferrer"},Yn=s("Gilaus mokymosi sistema caffe taip pat naudoja lmdb kaip duomen\u0173 saugykl\u0105"),Hn=s("."),Jn={href:"https://github.com/erthink/libmdbx#added-features",target:"_blank",rel:"noopener noreferrer"},Wn=s("mdbx yra 30 % greitesnis u\u017E lmdb pagal \u012Fterpt\u0173j\u0173 \u012Frengini\u0173 na\u0161umo test\u0173 lyginam\u0105j\u012F indeks\u0105 ioarena"),Qn=s("."),Zn=n("p",null,[n("img",{src:"https://raw.githubusercontent.com/wiki/erthink/libmdbx/img/perf-slide-1.png",alt:""}),n("br"),n("img",{src:"https://raw.githubusercontent.com/wiki/erthink/libmdbx/img/perf-slide-3.png",alt:""}),n("br"),n("img",{src:"https://raw.githubusercontent.com/wiki/erthink/libmdbx/img/perf-slide-4.png",alt:""}),n("br"),n("img",{src:"https://raw.githubusercontent.com/wiki/erthink/libmdbx/img/perf-slide-5.png",alt:""})],-1),ns=s("Tuo pat metu mdbx "),ss={href:"https://github.com/erthink/libmdbx#improvements-beyond-lmdb",target:"_blank",rel:"noopener noreferrer"},as=s("pagerina daugel\u012F"),ts=s(" lmdb "),ps={href:"https://github.com/erthink/libmdbx#improvements-beyond-lmdb",target:"_blank",rel:"noopener noreferrer"},os=s("tr\u016Bkum\u0173"),cs=s(", tod\u0117l Erigon (naujos kartos ethereum klientas) neseniai per\u0117jo nuo LMDB prie MDBX "),es=n("sup",{class:"footnote-ref"},[n("a",{href:"#fn1",id:"fnref1"},"[1]")],-1),us=s("."),ls=c(`<h2 id="pamokos" tabindex="-1"><a class="header-anchor" href="#pamokos" aria-hidden="true">#</a> Pamokos</h2><h3 id="kaip-paleisti-pavyzdi" tabindex="-1"><a class="header-anchor" href="#kaip-paleisti-pavyzdi" aria-hidden="true">#</a> Kaip paleisti pavyzd\u012F</h3><p>Pirmiausia klonuokite programin\u0119 baz\u0119 <code>git clone git@github.com:rmw-lib/mdbx.git --depth=1 &amp;&amp; cd mdbx</code></p><p>Tada paleiskite <code>cargo run --example 01</code> ir jis veiks <code>examples/01.rs</code></p><p>Jei tai j\u016Bs\u0173 projektas, pirmiausia paleiskite j\u012F:</p><div class="language-bash ext-sh"><pre class="language-bash"><code>cargo <span class="token function">install</span> cargo-edit
cargo <span class="token function">add</span> mdbx lazy_static ctor <span class="token function">paste</span>
</code></pre></div><h3 id="_1-pavyzdys-rasymas-set-key-val-ir-skaitymas-get-key" tabindex="-1"><a class="header-anchor" href="#_1-pavyzdys-rasymas-set-key-val-ir-skaitymas-get-key" aria-hidden="true">#</a> 1 pavyzdys : ra\u0161ymas <code>set(key,val)</code> ir skaitymas <code>.get(key)</code></h3>`,7),ks=s("Panagrin\u0117kime paprast\u0105 "),is={href:"https://github.com/rmw-lib/mdbx/blob/master/examples/01.rs",target:"_blank",rel:"noopener noreferrer"},rs=s("pavyzd\u012F/01.rs"),ms=c(`<h4 id="kodas" tabindex="-1"><a class="header-anchor" href="#kodas" aria-hidden="true">#</a> Kodas</h4><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// I\u0161vesti libmdbx versijos numer\u012F</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Daugiasluoksnis skaitymas ir ra\u0161ymas</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="paleisti-isvesti" tabindex="-1"><a class="header-anchor" href="#paleisti-isvesti" aria-hidden="true">#</a> Paleisti i\u0161vest\u012F</h4><div class="language-text ext-text"><pre class="language-text"><code>mdbx file path /Users/z/rmw/mdbx/target/debug/examples/01.mdb
mdbx version https://github.com/erthink/libmdbx/releases/tag/v0.11.2
test1 get Ok(Some(Bin([6])))
[6]
</code></pre></div><h4 id="kodo-aprasymas" tabindex="-1"><a class="header-anchor" href="#kodo-aprasymas" aria-hidden="true">#</a> Kodo apra\u0161ymas</h4><h5 id="env-rw-duomenu-bazes-apibrezimas" tabindex="-1"><a class="header-anchor" href="#env-rw-duomenu-bazes-apibrezimas" aria-hidden="true">#</a> <code>env_rw!</code> Duomen\u0173 baz\u0117s apibr\u0117\u017Eimas</h5><p>Kodas pradedamas makru env_rw, kuris turi 4 parametrus.</p>`,7),ds=n("li",null,[n("p",null,"Duomen\u0173 baz\u0117s aplinkos kintamojo pavadinimas")],-1),bs=s("Gr\u0105\u017Eina objekt\u0105, "),ys={href:"https://docs.rs/mdbx/latest/src/mdbx/env.rs.html#27-35",target:"_blank",rel:"noopener noreferrer"},gs=s("mdbx:: env:: Config"),fs=s("."),_s=c(`<p>Naudojame numatyt\u0105j\u0105 konfig\u016Bracij\u0105, nes <code>Env</code> \u012Fgyvendina <code>From&lt;Into&lt;PathBuf&gt;&gt;</code>, tod\u0117l tinka duomen\u0173 baz\u0117s kelias <code>into()</code>, o numatytosios konfig\u016Bracijos konfig\u016Bracija yra tokia.</p><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
<span class="token constant">MDBX</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
r<span class="token punctuation">,</span>
w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
<span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
<span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token comment">// I\u0161vesti libmdbx versijos numer\u012F</span>
<span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span>
    <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
    mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Daugiasluoksnis skaitymas ir ra\u0161ymas</span>
<span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
  test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

<span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
  path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
  mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
  flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
  sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
  sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
  max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
  pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
  <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
    <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
    sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// Per 1/65536 sekund\u0117s dal\u012F</span>
    sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
    max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
    flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
      <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
      <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
      <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
      <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
      <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
      <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>`,2),ws=n("code",null,"max_db",-1),hs=s(" \u0160\u012F nustatym\u0105 galima i\u0161 naujo nustatyti kiekvien\u0105 kart\u0105 "),vs={href:"https://github.com/erthink/libmdbx",target:"_blank",rel:"noopener noreferrer"},xs=s("atidarant"),qs=s(" duomen\u0173 baz\u0119, ta\u010Diau per didelis jo nustatymas tur\u0117s \u012Ftakos na\u0161umui, tod\u0117l nustatykite j\u012F pagal poreik\u012F."),Ds=s("Kit\u0173 parametr\u0173 reik\u0161m\u0119 rasite "),Es={href:"https://erthink.github.io/libmdbx/group__c__opening.html#ga9138119a904355d245777c4119534061",target:"_blank",rel:"noopener noreferrer"},Bs=s("libmdbx dokumentacijoje"),Ts=s("."),Ms=c('<ol start="3"><li><p>Duomen\u0173 baz\u0117s skaitymo sandorio makroaplinka, numatytasis dydis yra <code>r</code></p></li><li><p>Duomen\u0173 baz\u0117s ra\u0161ymo sandorio makro\u012Fra\u0161o pavadinimas, numatytoji reik\u0161m\u0117 yra <code>w</code></p></li></ol><p>3 ir 4 parametr\u0173 galima nepateikti, kad b\u016Bt\u0173 naudojamos numatytoji reik\u0161m\u0117.</p><h5 id="makroaplinkos-pletra" tabindex="-1"><a class="header-anchor" href="#makroaplinkos-pletra" aria-hidden="true">#</a> Makroaplinkos pl\u0117tra</h5><p>Jei norite pamatyti, k\u0105 daro makrokomandos magija, galite j\u0105 i\u0161pl\u0117sti naudodami <code>cargo expand --example 01</code> makrokomand\u0105, kuri\u0105 pirmiausia reikia \u012Fdiegti. <code>cargo install cargo-expand</code></p><p>Toliau pateikiama i\u0161pl\u0117stinio kodo ekrano kopija.</p><p><img src="//irmw.gumlet.io/PDzEtT.png" alt="PDzEtT"></p><h5 id="anyhow-ir-lazy-static" tabindex="-1"><a class="header-anchor" href="#anyhow-ir-lazy-static" aria-hidden="true">#</a> anyhow ir lazy_static</h5><p>I\u0161 i\u0161pl\u0117stinio ekrano paveiksl\u0117lio matyti, kad naudojami adresai <code>lazy_static</code> ir <code>anyhow</code>.</p>',8),js={href:"https://rustmagazine.github.io/rust_magazine_2021/chapter_2/rust_error_handle.html#thiserror--anyhow",target:"_blank",rel:"noopener noreferrer"},Ns=s("anyhow"),zs=s(" yra rust klaid\u0173 tvarkymo biblioteka."),Ss={href:"https://juejin.cn/post/7007336922817232927",target:"_blank",rel:"noopener noreferrer"},Xs=s("lazy_static"),Rs=s(" yra statinis kintamasis, kurio inicializacija atid\u0117ta."),Cs=n("p",null,"\u0160ios dvi bibliotekos yra labai paplitusios, tod\u0117l j\u0173 nenagrin\u0117siu.",-1),Os=n("h5",{id:"makro-mdbx",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#makro-mdbx","aria-hidden":"true"},"#"),s(" Makro mdbx!")],-1),Vs={href:"https://docs.rs/mdbx-proc/latest/src/mdbx_proc/lib.rs.html",target:"_blank",rel:"noopener noreferrer"},Is=n("code",null,"mdbx!",-1),Ps=s(" yra "),Us={href:"https://mp.weixin.qq.com/s/YT_HNFDCQ_IyocvBkRNJnA",target:"_blank",rel:"noopener noreferrer"},As=s("proced\u016Bros makrokomanda"),Ls=s("."),Fs=c(`<div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// I\u0161vesti libmdbx versijos numer\u012F</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Daugiasluoksnis skaitymas ir ra\u0161ymas</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
    sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
      <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
      sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// Per 1/65536 sekund\u0117s dal\u012F</span>
      sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
      max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
          <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
        <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
 <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
 <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Pirmoje eilut\u0117je pateikiamas duomen\u0173 baz\u0117s aplinkos kintamojo pavadinimas</p><p>Antroje eilut\u0117je \u012Fra\u0161omas duomen\u0173 baz\u0117s pavadinimas</p><p>Duomen\u0173 bazi\u0173 gali b\u016Bti daugiau nei viena, kiekvienai i\u0161 j\u0173 - po vien\u0105 eilut\u0119.</p><h5 id="siulai-ir-sandoriai" tabindex="-1"><a class="header-anchor" href="#siulai-ir-sandoriai" aria-hidden="true">#</a> Si\u016Blai ir sandoriai</h5><p>Pirmiau pateiktame kode demonstruojamas daugiasluoksnis skaitymas ir ra\u0161ymas.</p><p>Svarbu pa\u017Eym\u0117ti, kad vienu <strong>metu toje pa\u010Dioje gijoje</strong> gali b\u016Bti <strong>tik viena transakcija, jei gijoje bus atidaryta daugiau nei viena transakcija, programa nutr\u016Bks</strong>.</p><p>Sandoris bus patvirtintas taikymo srities pabaigoje.</p><h5 id="dvejetainiu-duomenu-skaitymas-ir-rasymas" tabindex="-1"><a class="header-anchor" href="#dvejetainiu-duomenu-skaitymas-ir-rasymas" aria-hidden="true">#</a> Dvejetaini\u0173 duomen\u0173 skaitymas ir ra\u0161ymas</h5><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// I\u0161vesti libmdbx versijos numer\u012F</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Daugiasluoksnis skaitymas ir ra\u0161ymas</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
    sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
      <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
      sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// Per 1/65536 sekund\u0117s dal\u012F</span>
      sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
      max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
          <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
        <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
 <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
 <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
 <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> t<span class="token punctuation">:</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div>`,10),$s=n("code",null,"set",-1),Gs=s(" yra \u012Fra\u0161ymas, "),Ks=n("code",null,"get",-1),Ys=s(" yra skaitymas, o bet kuris objektas, \u012Fgyvendinantis "),Hs={href:"https://doc.rust-lang.org/std/convert/trait.AsRef.html",target:"_blank",rel:"noopener noreferrer"},Js=n("code",null,"AsRef<[u8]>",-1),Ws=s(" objektas gali b\u016Bti \u012Fra\u0161ytas \u012F duomen\u0173 baz\u0119."),Qs=n("p",null,[n("code",null,"get"),s(" Gaunamas "),n("code",null,"Ok(Some(Bin([6])))"),s(", kuris gali b\u016Bti paverstas \u012F "),n("code",null,"&[u8]"),s(".")],-1),Zs=n("h3",{id:"_2-pavyzdys-duomenu-tipai-duomenu-bazes-zymos-istrynimas-narsymas",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#_2-pavyzdys-duomenu-tipai-duomenu-bazes-zymos-istrynimas-narsymas","aria-hidden":"true"},"#"),s(" 2 pavyzdys: Duomen\u0173 tipai, duomen\u0173 baz\u0117s \u017Eymos, i\u0161trynimas, nar\u0161ymas")],-1),na=s("Panagrin\u0117kime antr\u0105j\u012F "),sa={href:"https://github.com/rmw-lib/mdbx/blob/master/examples/02.rs",target:"_blank",rel:"noopener noreferrer"},aa=s("pavyzd\u012F/02.rs"),ta=s(":"),pa=c(`<p>\u0160iame pavyzdyje <code>env_rw!</code> praleistas, o tre\u010Diasis ir ketvirtasis argumentai ( <code>r</code>, <code>w</code>) praleisti.</p><h4 id="kodas-1" tabindex="-1"><a class="header-anchor" href="#kodas-1" aria-hidden="true">#</a> Kodas</h4><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// I\u0161vesti libmdbx versijos numer\u012F</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Daugiasluoksnis skaitymas ir ra\u0161ymas</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
    sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
      <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
      sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// Per 1/65536 sekund\u0117s dal\u012F</span>
      sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
      max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
          <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
        <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
 <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
 <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
 <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> t<span class="token punctuation">:</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintam\u0173j\u0173 pavadinimai ENV</span>
  <span class="token class-name">Test1</span>
  <span class="token class-name">Test2</span>
    key <span class="token class-name">Str</span>
    val <span class="token class-name">Str</span>
  <span class="token class-name">Test3</span>
    key <span class="token keyword">i32</span>
    val <span class="token keyword">u64</span>
  <span class="token class-name">Test4</span>
    key <span class="token keyword">u64</span>
    val <span class="token keyword">u16</span>
    flag <span class="token constant">DUPSORT</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Greitas ra\u0161ymas</span>
  <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Greitas skaitymas</span>
  <span class="token keyword">match</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>get <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;\\nu16::from_le_bytes({:?}) = {}&quot;</span><span class="token punctuation">,</span>
        r<span class="token punctuation">,</span>
        <span class="token keyword">u16</span><span class="token punctuation">::</span><span class="token function">from_le_bytes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Kelios operacijos keliose duomen\u0173 baz\u0117se per t\u0105 pa\u010Di\u0105 operacij\u0105</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>

    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test2 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test3 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test3</span><span class="token punctuation">;</span>

    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test3 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test4 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test4</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test4 rev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">rev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">dup</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;dup(16) {:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Sandoris bus \u012Fvykdytas pasibaigus taikymo sri\u010Diai</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="paleisti-isvesti-1" tabindex="-1"><a class="header-anchor" href="#paleisti-isvesti-1" aria-hidden="true">#</a> Paleisti i\u0161vest\u012F</h4><div class="language-text ext-text"><pre class="language-text"><code>mdbx file path /Users/z/rmw/mdbx/target/debug/examples/02.mdb

u16::from_le_bytes(Bin([4, 5])) = 1284

-- loop test1
[2] = [3]
[2, 3] = [4, 5]
[8, 1] = [9]
[9] = [10, 12]
[97, 98, 99] = [48, 49, 50]
[114, 109, 119, 46, 108, 105, 110, 107] = [68, 111, 119, 110, 32, 119, 105, 116, 104, 32, 68, 97, 116, 97, 32, 72, 101, 103, 101, 109, 111, 110, 121]
[examples/02.rs:57] test1.del_val([8, 1], [3])? = false
[examples/02.rs:58] test1.get([8, 1])?.unwrap() = Bin(
    [
        9,
    ],
)
[examples/02.rs:59] test1.del_val([8, 1], [9])? = true
[examples/02.rs:60] test1.get([8, 1])? = None
[examples/02.rs:62] test1.del([9])? = true
[examples/02.rs:63] test1.get([9])? = None
[examples/02.rs:64] test1.del([9])? = false

-- loop test2
abc = 012
rmw.link = Down with Data Hegemony

-- loop test3
0 = 6
10 = 5
13 = 32
16 = 32
-15 = 6
-12 = 6
-10 = 6
[examples/02.rs:100] test4.del_val(0, 2)? = true
[examples/02.rs:101] test4.del_val(0, 2)? = false

-- loop test4 rev
16 = 3
16 = 2
16 = 1
13 = 32
10 = 5
10 = 0
0 = 6
dup(16) 1
dup(16) 2
dup(16) 3
</code></pre></div><h4 id="greitas-skaitymas-ir-rasymas" tabindex="-1"><a class="header-anchor" href="#greitas-skaitymas-ir-rasymas" aria-hidden="true">#</a> Greitas skaitymas ir ra\u0161ymas</h4><p>Jei norime tiesiog nuskaityti arba \u012Fra\u0161yti vien\u0105 duomen\u0173 eilut\u0119, galime naudoti makrokomand\u0105.</p><p>Skaityti duomenis</p><div class="language-text ext-text"><pre class="language-text"><code>r!(Test1.get [2, 3])
</code></pre></div><p>Duomen\u0173 ra\u0161ymas</p><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// I\u0161vesti libmdbx versijos numer\u012F</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Daugiasluoksnis skaitymas ir ra\u0161ymas</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
    sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
      <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
      sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// Per 1/65536 sekund\u0117s dal\u012F</span>
      sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
      max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
          <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
        <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
 <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
 <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
 <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> t<span class="token punctuation">:</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintam\u0173j\u0173 pavadinimai ENV</span>
  <span class="token class-name">Test1</span>
  <span class="token class-name">Test2</span>
    key <span class="token class-name">Str</span>
    val <span class="token class-name">Str</span>
  <span class="token class-name">Test3</span>
    key <span class="token keyword">i32</span>
    val <span class="token keyword">u64</span>
  <span class="token class-name">Test4</span>
    key <span class="token keyword">u64</span>
    val <span class="token keyword">u16</span>
    flag <span class="token constant">DUPSORT</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Greitas ra\u0161ymas</span>
  <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Greitas skaitymas</span>
  <span class="token keyword">match</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>get <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;\\nu16::from_le_bytes({:?}) = {}&quot;</span><span class="token punctuation">,</span>
        r<span class="token punctuation">,</span>
        <span class="token keyword">u16</span><span class="token punctuation">::</span><span class="token function">from_le_bytes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Kelios operacijos keliose duomen\u0173 baz\u0117se per t\u0105 pa\u010Di\u0105 operacij\u0105</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>

    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test2 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test3 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test3</span><span class="token punctuation">;</span>

    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test3 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test4 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test4</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test4 rev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">rev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">dup</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;dup(16) {:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Sandoris bus \u012Fvykdytas pasibaigus taikymo sri\u010Diai</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div>`,11),oa=s("Viskas vienoje eilut\u0117je, kaip para\u0161yta "),ca={href:"https://github.com/rmw-lib/mdbx/blob/master/examples/02.rs",target:"_blank",rel:"noopener noreferrer"},ea=s("examples/02.rs."),ua=n("h4",{id:"duomenu-tipai",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#duomenu-tipai","aria-hidden":"true"},"#"),s(" Duomen\u0173 tipai")],-1),la=s("Duomen\u0173 baz\u0117s apibr\u0117\u017Etis examples/02. "),ka={href:"https://github.com/rmw-lib/mdbx/blob/master/examples/02.rs",target:"_blank",rel:"noopener noreferrer"},ia=s("rs"),ra=s(" atrodo taip :"),ma=c(`<div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// I\u0161vesti libmdbx versijos numer\u012F</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Daugiasluoksnis skaitymas ir ra\u0161ymas</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
    sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
      <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
      sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// Per 1/65536 sekund\u0117s dal\u012F</span>
      sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
      max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
          <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
        <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
 <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
 <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
 <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> t<span class="token punctuation">:</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintam\u0173j\u0173 pavadinimai ENV</span>
  <span class="token class-name">Test1</span>
  <span class="token class-name">Test2</span>
    key <span class="token class-name">Str</span>
    val <span class="token class-name">Str</span>
  <span class="token class-name">Test3</span>
    key <span class="token keyword">i32</span>
    val <span class="token keyword">u64</span>
  <span class="token class-name">Test4</span>
    key <span class="token keyword">u64</span>
    val <span class="token keyword">u16</span>
    flag <span class="token constant">DUPSORT</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Greitas ra\u0161ymas</span>
  <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Greitas skaitymas</span>
  <span class="token keyword">match</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>get <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;\\nu16::from_le_bytes({:?}) = {}&quot;</span><span class="token punctuation">,</span>
        r<span class="token punctuation">,</span>
        <span class="token keyword">u16</span><span class="token punctuation">::</span><span class="token function">from_le_bytes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Kelios operacijos keliose duomen\u0173 baz\u0117se per t\u0105 pa\u010Di\u0105 operacij\u0105</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>

    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test2 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test3 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test3</span><span class="token punctuation">;</span>

    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test3 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test4 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test4</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test4 rev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">rev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">dup</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;dup(16) {:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Sandoris bus \u012Fvykdytas pasibaigus taikymo sri\u010Diai</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token class-name">Test2</span>
  key <span class="token class-name">Str</span>
  val <span class="token class-name">Str</span>
<span class="token class-name">Test3</span>
  key <span class="token keyword">i32</span>
  val <span class="token keyword">u64</span>
<span class="token class-name">Test4</span>
  key <span class="token keyword">u64</span>
  val <span class="token keyword">u16</span>
  flag <span class="token constant">DUPSORT</span>
</code></pre></div><p>kur <code>key</code> ir <code>val</code> atitinkamai apibr\u0117\u017Eia rakt\u0173 ir reik\u0161mi\u0173 duomen\u0173 tipus.</p><p>Jei bandysite \u012Fra\u0161yti duomen\u0173 tip\u0105, kuris neatitinka apibr\u0117\u017Etojo, bus prane\u0161ta apie klaid\u0105, kaip parodyta toliau pateiktoje ekrano kopijoje :</p><p><img src="//irmw.gumlet.io/4rFTC6.png" alt=""></p>`,4),da=s("Numatytasis duomen\u0173 tipas yra "),ba={href:"https://docs.rs/mdbx/latest/mdbx/type/struct.Bin.html",target:"_blank",rel:"noopener noreferrer"},ya=n("code",null,"Bin",-1),ga=s(" , galima \u012Fra\u0161yti bet kokius duomenis, kurie \u012Fgyvendina "),fa=n("code",null,"AsRef<[u8]>",-1),_a=s("."),wa=s("Jei raktas arba reik\u0161m\u0117 yra "),ha=n("code",null,"utf8",-1),va=s(" eilut\u0117, duomen\u0173 tip\u0105 galima nustatyti \u012F "),xa={href:"https://docs.rs/mdbx/latest/mdbx/type/struct.Str.html",target:"_blank",rel:"noopener noreferrer"},qa=n("code",null,"Str",-1),Da=s(" ."),Ea={href:"https://doc.rust-lang.org/std/ops/trait.Deref.html",target:"_blank",rel:"noopener noreferrer"},Ba=s("Atk\u0117lus"),Ta=s(),Ma=n("code",null,"Str",-1),ja=s(" bus gr\u0105\u017Einta eilut\u0117, pana\u0161i \u012F "),Na=n("code",null,"let k:&str = &k;",-1),za=s("."),Sa=s("Be to, svetain\u0117je "),Xa=n("code",null,"Str",-1),Ra=s(" taip pat \u012Fdiegta "),Ca={href:"https://doc.rust-lang.org/std/fmt/trait.Display.html",target:"_blank",rel:"noopener noreferrer"},Oa=n("code",null,"std::fmt::Display",-1),Va=s(" , "),Ia=n("code",null,'println!("{}",k)',-1),Pa=s(" i\u0161ves skaitom\u0105 eilut\u0119."),Ua=n("h5",{id:"is-anksto-nustatyti-duomenu-tipai",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#is-anksto-nustatyti-duomenu-tipai","aria-hidden":"true"},"#"),s(" I\u0161 anksto nustatyti duomen\u0173 tipai")],-1),Aa=s("Be "),La=n("code",null,"Str",-1),Fa=s(" ir "),$a=n("code",null,"Bin",-1),Ga=s(", pl\u0117tinys taip pat palaiko "),Ka={href:"https://docs.rs/mdbx/latest/src/mdbx/type.rs.html#48",target:"_blank",rel:"noopener noreferrer"},Ya=s("usize, u128, u64, u32, u16, u8, isize, i128, i64, i32, i16, i8, f32, f64"),Ha=s(" duomenis."),Ja=n("h4",{id:"duomenu-bazes-veliavos",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#duomenu-bazes-veliavos","aria-hidden":"true"},"#"),s(" Duomen\u0173 baz\u0117s v\u0117liavos")],-1),Wa=s("Duomen\u0173 baz\u0117s \u017Eymes, prid\u0117tas prie "),Qa={href:"https://github.com/rmw-lib/mdbx/blob/master/examples/02.rs",target:"_blank",rel:"noopener noreferrer"},Za=s("examples/02.rs"),nt=s(" duomen\u0173, galite pamatyti adresu "),st=n("code",null,"Test4",-1),at=s(". "),tt=n("code",null,"flag DUPSORT",-1),pt=s("Libmdbx duomen\u0173 baz\u0117 turi kelet\u0105 v\u0117liav\u0173 ( "),ot={href:"https://erthink.github.io/libmdbx/group__c__dbi.html#gafe3bddb297b3ab0d828a487c5726f76a",target:"_blank",rel:"noopener noreferrer"},ct=n("code",null,"MDBX_db_flags_t",-1),et=s(" ), kuriuos galima nustatyti."),ut=c('<ul><li>REVERSEKEY raktams naudojamas atvirk\u0161tinis eilu\u010Di\u0173 palyginimas. (naudinga, kai kaip klavi\u0161us naudojate ma\u017Eus galinius koduotus numerius)</li><li>DUPSORT naudoja sur\u016B\u0161iuotus dublikatus, t. y. leid\u017Eia naudoti kelias rakto reik\u0161mes.</li><li>INTEGERKEY Nat\u016Bralus bait\u0173 tvarka i\u0161d\u0117stytas skaitinis raktas uint32_t arba uint64_t. Raktai turi b\u016Bti vienodo dyd\u017Eio ir perduodami kaip argumentas turi b\u016Bti i\u0161lyginti.</li><li>DUPFIXED Duomen\u0173 reik\u0161mi\u0173 dydis turi b\u016Bti vienodas, jei naudojamas DUPSORT (galima greitai suskai\u010Diuoti reik\u0161mi\u0173 skai\u010Di\u0173).</li><li>INTEGERDUP reikalingos DUPSORT ir DUPFIXED; reik\u0161m\u0117s yra sveikieji skai\u010Diai (pana\u0161iai kaip INTEGERKEY). Visos duomen\u0173 reik\u0161m\u0117s turi b\u016Bti vienodo dyd\u017Eio ir perduodamos kaip parametrai turi b\u016Bti i\u0161lygintos.</li><li>REVERSEDUP naudoja DUPSORT; duomen\u0173 vert\u0117ms naudojamas atvirk\u0161tinis eilu\u010Di\u0173 palyginimas.</li><li>CREATE sukuria DB, jei ji neegzistuoja (pridedama pagal numatytuosius nustatymus).</li><li>DB_ACCEDE Atidaro esam\u0105 subduomen\u0173 baz\u0119, sukurt\u0105 naudojant ne\u017Einom\u0105 po\u017Eym\u012F.<br> \u0160i DB_ACCEDE \u017Eyma skirta esamoms dalin\u0117ms duomen\u0173 baz\u0117ms, sukurtoms su ne\u017Einomomis v\u0117liavomis (REVERSEKEY, DUPSORT, INTEGERKEY, DUPFIXED, INTEGERDUP ir REVERSEDUP), atverti.<br> Tokiu atveju poduomen\u0173 baz\u0117 negr\u0105\u017Eins INCOMPATIBLE klaidos, bet bus atidaryta su v\u0117liavomis, kurios buvo naudojamos jai sukurti, o programa gal\u0117s nustatyti tikr\u0105sias v\u0117liavas naudodama mdbx_dbi_flags().</li></ul><h5 id="dupsort-vienas-raktas-atitinka-daugiau-nei-viena-reiksme" tabindex="-1"><a class="header-anchor" href="#dupsort-vienas-raktas-atitinka-daugiau-nei-viena-reiksme" aria-hidden="true">#</a> DUPSORT : vienas raktas atitinka daugiau nei vien\u0105 reik\u0161m\u0119</h5><p><code>DUPSORT</code>rei\u0161kia, kad rakt\u0105 gali atitikti daugiau nei viena reik\u0161m\u0117.</p><p>Jei norite nustatyti kelias v\u0117liav\u0117les, ra\u0161ykite taip <code>flag DUPSORT | DUPFIXED</code></p><h5 id="dup-key-iteratorius-kuris-grazina-visas-rakta-atitinkancias-reiksmes" tabindex="-1"><a class="header-anchor" href="#dup-key-iteratorius-kuris-grazina-visas-rakta-atitinkancias-reiksmes" aria-hidden="true">#</a> <code>.dup(key)</code> iteratorius, kuris gr\u0105\u017Eina visas rakt\u0105 atitinkan\u010Dias reik\u0161mes.</h5><p>\u0160i\u0105 funkcij\u0105 galima naudoti tik <code>DUPSORT</code> pa\u017Eym\u0117tose duomen\u0173 baz\u0117se, kuriose rakt\u0105 gali atitikti daugiau nei viena reik\u0161m\u0117.</p><p><code>DUPSORT</code> duomen\u0173 baz\u0117se <code>get</code> gr\u0105\u017Eina tik pirm\u0105j\u0105 \u0161io rakto reik\u0161m\u0119. Jei norite gauti visas reik\u0161mes, naudokite <code>dup</code>.</p><h5 id="numatytuoju-atveju-automatiskai-pridedamos-duomenu-bazes-veliaveles" tabindex="-1"><a class="header-anchor" href="#numatytuoju-atveju-automatiskai-pridedamos-duomenu-bazes-veliaveles" aria-hidden="true">#</a> Numatytuoju atveju automati\u0161kai pridedamos duomen\u0173 baz\u0117s v\u0117liav\u0117l\u0117s</h5>',8),lt=s("Kai duomen\u0173 tipas yra "),kt=n("code",null,"u32",-1),it=s(" / "),rt=n("code",null,"u64",-1),mt=s(" / "),dt=n("code",null,"usize",-1),bt=s(", automati\u0161kai pridedama duomen\u0173 baz\u0117s \u017Eyma. "),yt={href:"https://docs.rs/mdbx-proc/latest/src/mdbx_proc/lib.rs.html#105",target:"_blank",rel:"noopener noreferrer"},gt=n("code",null,"INTEGERKEY",-1),ft=s(" ."),_t=s("Ma\u0161inose su ma\u017E\u0173j\u0173 gal\u016Bni\u0173 kodavimu kiti skaitmen\u0173 tipai pridedami automati\u0161kai. "),wt={href:"https://docs.rs/mdbx-proc/latest/src/mdbx_proc/lib.rs.html#108",target:"_blank",rel:"noopener noreferrer"},ht=n("code",null,"REVERSEKEY",-1),vt=s(" Duomen\u0173 baz\u0117s \u017Eyma pridedama automati\u0161kai, kai duomen\u0173 tipas yra / / ."),xt=c('<h4 id="duomenu-salinimas" tabindex="-1"><a class="header-anchor" href="#duomenu-salinimas" aria-hidden="true">#</a> Duomen\u0173 \u0161alinimas</h4><h5 id="del-key-klaviso-pasalinimas" tabindex="-1"><a class="header-anchor" href="#del-key-klaviso-pasalinimas" aria-hidden="true">#</a> <code>.del(key)</code> Klavi\u0161o pa\u0161alinimas</h5><p><code>.del(val)</code> I\u0161trina rakt\u0105 atitinkan\u010Di\u0105 reik\u0161m\u0119.</p><p>Jei duomen\u0173 baz\u0117je yra \u017Eyma <code>DUPSORT</code>, visos \u0161io rakto reik\u0161m\u0117s bus i\u0161trintos.</p><p>Gr\u0105\u017Eina <code>true</code>, jei i\u0161trinti visi duomenys, ir <code>false</code>, jei ne.</p><h5 id="del-val-key-val-tikslaus-atitikmens-istrynimas" tabindex="-1"><a class="header-anchor" href="#del-val-key-val-tikslaus-atitikmens-istrynimas" aria-hidden="true">#</a> <code>.del_val(key,val)</code> Tikslaus atitikmens i\u0161trynimas</h5><p><code>.del_val(key,val)</code> Pa\u0161alina rakto ir vert\u0117s poras, kurios tiksliai atitinka \u012Fvesties parametrus.</p><p>Gr\u0105\u017Eina <code>true</code>, jei i\u0161trinti visi duomenys, ir <code>false</code>, jei ne.</p><h4 id="narsymas" tabindex="-1"><a class="header-anchor" href="#narsymas" aria-hidden="true">#</a> Nar\u0161ymas</h4><h5 id="nuoseklioji-apziura" tabindex="-1"><a class="header-anchor" href="#nuoseklioji-apziura" aria-hidden="true">#</a> nuoseklioji ap\u017Ei\u016Bra</h5>',10),qt=s("D\u0117l \u012Fgyvendinimo "),Dt={href:"https://doc.rust-lang.org/std/iter/trait.IntoIterator.html",target:"_blank",rel:"noopener noreferrer"},Et=n("code",null,"std::iter::IntoIterator",-1),Bt=s(" . galite keliauti tiesiai taip:"),Tt=n("p",null,[n("code",null,"for (k, v) in test1")],-1),Mt=n("h5",{id:"rev-atvirkstines-tvarkos-narsymas",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#rev-atvirkstines-tvarkos-narsymas","aria-hidden":"true"},"#"),s(),n("code",null,".rev()"),s(" Atvirk\u0161tin\u0117s tvarkos nar\u0161ymas")],-1),jt=n("p",null,[n("code",null,"for (k, v) in test4.rev()")],-1),Nt=n("h5",{id:"rusiavimas",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#rusiavimas","aria-hidden":"true"},"#"),s(" R\u016B\u0161iavimas")],-1),zt=s("Libmdbx raktai sur\u016B\u0161iuoti "),St={href:"https://zh.wikipedia.org/wiki/%E5%AD%97%E5%85%B8%E5%BA%8F",target:"_blank",rel:"noopener noreferrer"},Xt=s("\u017Eodyno tvarka"),Rt=s("."),Ct=c(`<ul><li><p>Nepa\u017Eym\u0117tiems skai\u010Diams</p><p>r\u016B\u0161iuojami nuo ma\u017Eiausio iki did\u017Eiausio, nes automati\u0161kai pridedamos duomen\u0173 baz\u0117s \u017Eymos ( <code>u32</code>/ <code>u64</code>/ <code>usize</code> pridedamos prie <code>INTEGERKEY</code>, kitos - prie <code>REVERSEKEY</code>, priklausomai nuo ma\u0161ininio kodo).</p></li><li><p>Pasira\u0161ytiems skai\u010Diams</p><p>eili\u0161kumas yra toks: pirmiausia 0, tada visi teigiami skai\u010Diai nuo ma\u017Eiausio iki did\u017Eiausio, tada visi neigiami skai\u010Diai nuo ma\u017Eiausio iki did\u017Eiausio.</p></li></ul><h3 id="intervaliniai-iteratoriai" tabindex="-1"><a class="header-anchor" href="#intervaliniai-iteratoriai" aria-hidden="true">#</a> Intervaliniai iteratoriai</h3><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// I\u0161vesti libmdbx versijos numer\u012F</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Daugiasluoksnis skaitymas ir ra\u0161ymas</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
    sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
      <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
      sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// Per 1/65536 sekund\u0117s dal\u012F</span>
      sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
      max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
          <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
        <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
 <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
 <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
 <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> t<span class="token punctuation">:</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintam\u0173j\u0173 pavadinimai ENV</span>
  <span class="token class-name">Test1</span>
  <span class="token class-name">Test2</span>
    key <span class="token class-name">Str</span>
    val <span class="token class-name">Str</span>
  <span class="token class-name">Test3</span>
    key <span class="token keyword">i32</span>
    val <span class="token keyword">u64</span>
  <span class="token class-name">Test4</span>
    key <span class="token keyword">u64</span>
    val <span class="token keyword">u16</span>
    flag <span class="token constant">DUPSORT</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Greitas ra\u0161ymas</span>
  <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Greitas skaitymas</span>
  <span class="token keyword">match</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>get <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;\\nu16::from_le_bytes({:?}) = {}&quot;</span><span class="token punctuation">,</span>
        r<span class="token punctuation">,</span>
        <span class="token keyword">u16</span><span class="token punctuation">::</span><span class="token function">from_le_bytes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Kelios operacijos keliose duomen\u0173 baz\u0117se per t\u0105 pa\u010Di\u0105 operacij\u0105</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>

    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test2 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test3 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test3</span><span class="token punctuation">;</span>

    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test3 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test4 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test4</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test4 rev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">rev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">dup</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;dup(16) {:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Sandoris bus \u012Fvykdytas pasibaigus taikymo sri\u010Diai</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token class-name">Test2</span>
  key <span class="token class-name">Str</span>
  val <span class="token class-name">Str</span>
<span class="token class-name">Test3</span>
  key <span class="token keyword">i32</span>
  val <span class="token keyword">u64</span>
<span class="token class-name">Test4</span>
  key <span class="token keyword">u64</span>
  val <span class="token keyword">u16</span>
  flag <span class="token constant">DUPSORT</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span>
  <span class="token class-name">Test0</span>
  <span class="token class-name">Test1</span>
    key <span class="token keyword">u16</span>
    val <span class="token keyword">u64</span>
    flag <span class="token constant">DUPSORT</span>
  <span class="token class-name">Test2</span>
    key <span class="token keyword">u32</span>
    val <span class="token keyword">u64</span>
<span class="token punctuation">}</span>

<span class="token macro property">macro_rules!</span> range_rev <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ident</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n# {}.rev_range({:?})&quot;</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$var</span><span class="token punctuation">.</span><span class="token function">range_rev</span><span class="token punctuation">(</span><span class="token variable">$range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property">macro_rules!</span> range <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ident</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n# {}.range({:?})&quot;</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$var</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token variable">$range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n&gt; Test0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test0 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test0</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">range!</span><span class="token punctuation">(</span>test0<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> begin<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test0<span class="token punctuation">,</span> begin<span class="token punctuation">..=</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;-- all&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n&gt; Test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="paleiskite-isvesti" tabindex="-1"><a class="header-anchor" href="#paleiskite-isvesti" aria-hidden="true">#</a> Paleiskite i\u0161vest\u012F</h4><div class="language-text ext-text"><pre class="language-text"><code>mdbx file path /Users/z/rmw/mdbx/target/debug/examples/range.mdb

&gt; Test0

# test0.range([1]..)
(Bin([1]), Bin([1, 2]))
(Bin([1, 1]), Bin([1, 3]))
(Bin([1, 2]), Bin([1, 3]))
(Bin([2]), Bin([2, 3]))
(Bin([3]), Bin([]))

# test0.range([1, 1]..=[2])
(Bin([1, 1]), Bin([1, 3]))
(Bin([1, 2]), Bin([1, 3]))
(Bin([2]), Bin([2, 3]))
-- all
(2, 4)
(2, 9)
(3, 0)
(3, 8)
(5, 3)
(5, 8)
(9, 1)
(9, 2)
(9, 7)

# test1.range(1..3)
(2, 4)
(2, 9)

# test1.range(5..2)
(5, 8)
(5, 3)
(3, 8)
(3, 0)

# test1.range(1..=3)
(2, 4)
(2, 9)
(3, 0)
(3, 8)

# test1.range(..3)
(2, 4)
(2, 9)

# test1.range(3..)
(3, 0)
(3, 8)
(5, 3)
(5, 8)
(9, 1)
(9, 2)
(9, 7)

# test1.rev_range(..1)
(9, 7)
(9, 2)
(9, 1)
(5, 8)
(5, 3)
(3, 8)
(3, 0)
(2, 9)
(2, 4)

# test1.rev_range(..=1)
(9, 7)
(9, 2)
(9, 1)
(5, 8)
(5, 3)
(3, 8)
(3, 0)
(2, 9)
(2, 4)

&gt; Test2

# test2.range(1..3)
(1, 5)
(2, 4)

# test2.range(1..=3)
(1, 5)
(2, 4)

# test2.range(..3)
(0, 0)
(1, 5)
(2, 4)

# test2.range(2..)
(2, 4)
(9, 1)

# test2.rev_range(..1)
(9, 1)
(2, 4)

# test2.rev_range(2..)
(2, 4)
(1, 5)
(0, 0)

# test2.rev_range(..=1)
(9, 1)
(2, 4)
(1, 5)
</code></pre></div><h4 id="range-begin-end-intervalo-iteracija" tabindex="-1"><a class="header-anchor" href="#range-begin-end-intervalo-iteracija" aria-hidden="true">#</a> <code>.range(begin..end)</code> Intervalo iteracija</h4><p>Kalbant apie skai\u010Dius, intervalas yra skaitinis intervalas.</p><p>Dvejetainiams skai\u010Diams galima sudaryti tok\u012F pat\u012F interval\u0105, pvz.</p><div class="language-text ext-text"><pre class="language-text"><code>let begin : &amp;[u8] = &amp;[1,1];
for (k,v) in test0.range(begin..=&amp;[2]) {}
</code></pre></div><p>Jei <code>begin</code> yra didesnis u\u017E <code>end</code>, bus gr\u012F\u017Etama atgal.</p><p>Pavyzd\u017Eiui, <code>test1.range(5..2)</code> i\u0161ves tok\u012F :</p><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// I\u0161vesti libmdbx versijos numer\u012F</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Daugiasluoksnis skaitymas ir ra\u0161ymas</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
    sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
      <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
      sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// Per 1/65536 sekund\u0117s dal\u012F</span>
      sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
      max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
          <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
        <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
 <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
 <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
 <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> t<span class="token punctuation">:</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintam\u0173j\u0173 pavadinimai ENV</span>
  <span class="token class-name">Test1</span>
  <span class="token class-name">Test2</span>
    key <span class="token class-name">Str</span>
    val <span class="token class-name">Str</span>
  <span class="token class-name">Test3</span>
    key <span class="token keyword">i32</span>
    val <span class="token keyword">u64</span>
  <span class="token class-name">Test4</span>
    key <span class="token keyword">u64</span>
    val <span class="token keyword">u16</span>
    flag <span class="token constant">DUPSORT</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Greitas ra\u0161ymas</span>
  <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Greitas skaitymas</span>
  <span class="token keyword">match</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>get <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;\\nu16::from_le_bytes({:?}) = {}&quot;</span><span class="token punctuation">,</span>
        r<span class="token punctuation">,</span>
        <span class="token keyword">u16</span><span class="token punctuation">::</span><span class="token function">from_le_bytes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Kelios operacijos keliose duomen\u0173 baz\u0117se per t\u0105 pa\u010Di\u0105 operacij\u0105</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>

    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test2 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test3 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test3</span><span class="token punctuation">;</span>

    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test3 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test4 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test4</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test4 rev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">rev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">dup</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;dup(16) {:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Sandoris bus \u012Fvykdytas pasibaigus taikymo sri\u010Diai</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token class-name">Test2</span>
  key <span class="token class-name">Str</span>
  val <span class="token class-name">Str</span>
<span class="token class-name">Test3</span>
  key <span class="token keyword">i32</span>
  val <span class="token keyword">u64</span>
<span class="token class-name">Test4</span>
  key <span class="token keyword">u64</span>
  val <span class="token keyword">u16</span>
  flag <span class="token constant">DUPSORT</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span>
  <span class="token class-name">Test0</span>
  <span class="token class-name">Test1</span>
    key <span class="token keyword">u16</span>
    val <span class="token keyword">u64</span>
    flag <span class="token constant">DUPSORT</span>
  <span class="token class-name">Test2</span>
    key <span class="token keyword">u32</span>
    val <span class="token keyword">u64</span>
<span class="token punctuation">}</span>

<span class="token macro property">macro_rules!</span> range_rev <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ident</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n# {}.rev_range({:?})&quot;</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$var</span><span class="token punctuation">.</span><span class="token function">range_rev</span><span class="token punctuation">(</span><span class="token variable">$range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property">macro_rules!</span> range <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ident</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n# {}.range({:?})&quot;</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$var</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token variable">$range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n&gt; Test0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test0 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test0</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">range!</span><span class="token punctuation">(</span>test0<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> begin<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test0<span class="token punctuation">,</span> begin<span class="token punctuation">..=</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;-- all&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n&gt; Test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre></div>`,12),Ot=s("Intervalin\u0117 iteracija nepalaikoma "),Vt={href:"https://doc.rust-lang.org/std/ops/struct.RangeFull.html",target:"_blank",rel:"noopener noreferrer"},It=n("code",null,"RangeFull",-1),Pt=s(" t. y. "),Ut=n("code",null,"..",-1),At=s("naudojimas nepalaikomas, vietoj jo naudokite pirmiau min\u0117t\u0105 "),Lt=n("a",{href:"#%E9%81%8D%E5%8E%86"},"ap\u0117jim\u0105",-1),Ft=s("."),$t=c(`<h4 id="rev-range-apversti-intervalai" tabindex="-1"><a class="header-anchor" href="#rev-range-apversti-intervalai" aria-hidden="true">#</a> <code>.rev_range</code> Apversti intervalai</h4><p>Jei norite gauti apverst\u0105 interval\u0105, kuris yra ma\u017Eesnis arba lygus vertei, galite padaryti taip</p><div class="language-text ext-text"><pre class="language-text"><code>test2.rev_range(2..)
</code></pre></div><p>I\u0161vestis bus</p><div class="language-text ext-text"><pre class="language-text"><code>(2, 4)
(1, 5)
(0, 0)
</code></pre></div><p>Apverstam intervalui neturi b\u016Bti nustatytas vienas i\u0161 <code>begin</code> arba <code>end</code>; nes jei abu \u0161ie parametrai nustatyti, visada galite naudoti <code>range(end..begin)</code>, kad pasiektum\u0117te t\u0105 pat\u012F efekt\u0105.</p><h3 id="duomenu-tipu-pritaikymas" tabindex="-1"><a class="header-anchor" href="#duomenu-tipu-pritaikymas" aria-hidden="true">#</a> Duomen\u0173 tip\u0173 pritaikymas</h3>`,7),Gt=s("Demonstracin\u012F kod\u0105 galima rasti adresu "),Kt={href:"https://github.com/rmw-lib/mdbx-example/blob/master/01/src/main.rs",target:"_blank",rel:"noopener noreferrer"},Yt=s("github.com/rmw-lib/mdbx-example/01"),Ht=s("."),Jt=c(`<div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// I\u0161vesti libmdbx versijos numer\u012F</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Daugiasluoksnis skaitymas ir ra\u0161ymas</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
    sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
      <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
      sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// Per 1/65536 sekund\u0117s dal\u012F</span>
      sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
      max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
          <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
        <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
 <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
 <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
 <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> t<span class="token punctuation">:</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintam\u0173j\u0173 pavadinimai ENV</span>
  <span class="token class-name">Test1</span>
  <span class="token class-name">Test2</span>
    key <span class="token class-name">Str</span>
    val <span class="token class-name">Str</span>
  <span class="token class-name">Test3</span>
    key <span class="token keyword">i32</span>
    val <span class="token keyword">u64</span>
  <span class="token class-name">Test4</span>
    key <span class="token keyword">u64</span>
    val <span class="token keyword">u16</span>
    flag <span class="token constant">DUPSORT</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Greitas ra\u0161ymas</span>
  <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Greitas skaitymas</span>
  <span class="token keyword">match</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>get <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;\\nu16::from_le_bytes({:?}) = {}&quot;</span><span class="token punctuation">,</span>
        r<span class="token punctuation">,</span>
        <span class="token keyword">u16</span><span class="token punctuation">::</span><span class="token function">from_le_bytes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Kelios operacijos keliose duomen\u0173 baz\u0117se per t\u0105 pa\u010Di\u0105 operacij\u0105</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>

    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test2 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test3 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test3</span><span class="token punctuation">;</span>

    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test3 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test4 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test4</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test4 rev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">rev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">dup</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;dup(16) {:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Sandoris bus \u012Fvykdytas pasibaigus taikymo sri\u010Diai</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token class-name">Test2</span>
  key <span class="token class-name">Str</span>
  val <span class="token class-name">Str</span>
<span class="token class-name">Test3</span>
  key <span class="token keyword">i32</span>
  val <span class="token keyword">u64</span>
<span class="token class-name">Test4</span>
  key <span class="token keyword">u64</span>
  val <span class="token keyword">u16</span>
  flag <span class="token constant">DUPSORT</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span>
  <span class="token class-name">Test0</span>
  <span class="token class-name">Test1</span>
    key <span class="token keyword">u16</span>
    val <span class="token keyword">u64</span>
    flag <span class="token constant">DUPSORT</span>
  <span class="token class-name">Test2</span>
    key <span class="token keyword">u32</span>
    val <span class="token keyword">u64</span>
<span class="token punctuation">}</span>

<span class="token macro property">macro_rules!</span> range_rev <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ident</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n# {}.rev_range({:?})&quot;</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$var</span><span class="token punctuation">.</span><span class="token function">range_rev</span><span class="token punctuation">(</span><span class="token variable">$range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property">macro_rules!</span> range <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ident</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n# {}.range({:?})&quot;</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$var</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token variable">$range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n&gt; Test0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test0 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test0</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">range!</span><span class="token punctuation">(</span>test0<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> begin<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test0<span class="token punctuation">,</span> begin<span class="token punctuation">..=</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;-- all&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n&gt; Test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">speedy<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Readable</span><span class="token punctuation">,</span> <span class="token class-name">Writable</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(PartialEq, Debug, Readable, Writable)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">City</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
  lnglat<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">FromMdbx</span> <span class="token keyword">for</span> <span class="token class-name">City</span> <span class="token punctuation">{</span>
  <span class="token keyword">fn</span> <span class="token function-definition function">from_mdbx</span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> <span class="token class-name">PtrTx</span><span class="token punctuation">,</span> val<span class="token punctuation">:</span> <span class="token class-name">MDBX_val</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
    <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">read_from_buffer</span><span class="token punctuation">(</span><span class="token macro property">val_bytes!</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">ToAsRef</span><span class="token operator">&lt;</span><span class="token class-name">City</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;&gt;</span> <span class="token keyword">for</span> <span class="token class-name">City</span> <span class="token punctuation">{</span>
  <span class="token keyword">fn</span> <span class="token function-definition function">to_as_ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">write_to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span>
  <span class="token class-name">Test</span>
    key <span class="token keyword">u16</span>
    val <span class="token class-name">City</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> city <span class="token operator">=</span> <span class="token class-name">City</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;BeiJing&quot;</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    lnglat<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">11640</span><span class="token punctuation">,</span> <span class="token number">3990</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
  test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> city<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>I\u0161vestis yra tokia</p><div class="language-text ext-text"><pre class="language-text"><code>Some(City { name: &quot;BeiJing&quot;, lnglat: (11640, 3990) })
</code></pre></div>`,3),Wt=s("Pasirinktinio tipo pavyzdyje naudojame "),Qt={href:"https://github.com/koute/speedy",target:"_blank",rel:"noopener noreferrer"},Zt=n("code",null,"speedy",-1),np=s(" atlikti serijin\u012F vertinim\u0105 "),sp={href:"https://github.com/djkoloski/rust_serialization_benchmark",target:"_blank",rel:"noopener noreferrer"},ap=s("( "),tp=n("code",null,"speedy",-1),pp=s(" veiklos rezultat\u0173 ap\u017Evalga)"),op=s("."),cp=s("Pasirinktinio tipo \u012Fgyvendinimas "),ep={href:"https://docs.rs/mdbx/latest/mdbx/type/trait.FromMdbx.html",target:"_blank",rel:"noopener noreferrer"},up=n("code",null,"FromMdbx",-1),lp=s(" ir "),kp={href:"https://docs.rs/mdbx/latest/mdbx/type/trait.ToAsRef.html",target:"_blank",rel:"noopener noreferrer"},ip=n("code",null,"ToAsRef",-1),rp=s(" galima laikyti adresu "),mp=n("code",null,"mdbx",-1),dp=s("."),bp=s("Jei naudojate konkre\u010Di\u0105 serializavimo bibliotek\u0105, taip pat galite pritaikyti atribut\u0173 "),yp={href:"https://blog.logrocket.com/macros-in-rust-a-tutorial-with-examples/",target:"_blank",rel:"noopener noreferrer"},gp=s("makrokomandas"),fp=s(", kad procesas b\u016Bt\u0173 paprastesnis."),_p=n("h4",{id:"pasirinktiniu-tipu-supaprastinimas-naudojant-atributu-makrokomandas",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#pasirinktiniu-tipu-supaprastinimas-naudojant-atributu-makrokomandas","aria-hidden":"true"},"#"),s(" Pasirinktini\u0173 tip\u0173 supaprastinimas naudojant atribut\u0173 makrokomandas")],-1),wp=s("\u012Ediegti atribut\u0173 makrokomand\u0105 paprasta, nes "),hp={href:"https://crates.io/crates/mdbx_speedy",target:"_blank",rel:"noopener noreferrer"},vp=n("code",null,"mdbx_speedy",-1),xp=s(" Atributo makro kodas yra toks :"),qp=c(`<div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// I\u0161vesti libmdbx versijos numer\u012F</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Daugiasluoksnis skaitymas ir ra\u0161ymas</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
    sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
      <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
      sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// Per 1/65536 sekund\u0117s dal\u012F</span>
      sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
      max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
          <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
        <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
 <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
 <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
 <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> t<span class="token punctuation">:</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintam\u0173j\u0173 pavadinimai ENV</span>
  <span class="token class-name">Test1</span>
  <span class="token class-name">Test2</span>
    key <span class="token class-name">Str</span>
    val <span class="token class-name">Str</span>
  <span class="token class-name">Test3</span>
    key <span class="token keyword">i32</span>
    val <span class="token keyword">u64</span>
  <span class="token class-name">Test4</span>
    key <span class="token keyword">u64</span>
    val <span class="token keyword">u16</span>
    flag <span class="token constant">DUPSORT</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Greitas ra\u0161ymas</span>
  <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Greitas skaitymas</span>
  <span class="token keyword">match</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>get <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;\\nu16::from_le_bytes({:?}) = {}&quot;</span><span class="token punctuation">,</span>
        r<span class="token punctuation">,</span>
        <span class="token keyword">u16</span><span class="token punctuation">::</span><span class="token function">from_le_bytes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Kelios operacijos keliose duomen\u0173 baz\u0117se per t\u0105 pa\u010Di\u0105 operacij\u0105</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>

    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test2 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test3 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test3</span><span class="token punctuation">;</span>

    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test3 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test4 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test4</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test4 rev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">rev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">dup</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;dup(16) {:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Sandoris bus \u012Fvykdytas pasibaigus taikymo sri\u010Diai</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token class-name">Test2</span>
  key <span class="token class-name">Str</span>
  val <span class="token class-name">Str</span>
<span class="token class-name">Test3</span>
  key <span class="token keyword">i32</span>
  val <span class="token keyword">u64</span>
<span class="token class-name">Test4</span>
  key <span class="token keyword">u64</span>
  val <span class="token keyword">u16</span>
  flag <span class="token constant">DUPSORT</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span>
  <span class="token class-name">Test0</span>
  <span class="token class-name">Test1</span>
    key <span class="token keyword">u16</span>
    val <span class="token keyword">u64</span>
    flag <span class="token constant">DUPSORT</span>
  <span class="token class-name">Test2</span>
    key <span class="token keyword">u32</span>
    val <span class="token keyword">u64</span>
<span class="token punctuation">}</span>

<span class="token macro property">macro_rules!</span> range_rev <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ident</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n# {}.rev_range({:?})&quot;</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$var</span><span class="token punctuation">.</span><span class="token function">range_rev</span><span class="token punctuation">(</span><span class="token variable">$range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property">macro_rules!</span> range <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ident</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n# {}.range({:?})&quot;</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$var</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token variable">$range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n&gt; Test0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test0 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test0</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">range!</span><span class="token punctuation">(</span>test0<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> begin<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test0<span class="token punctuation">,</span> begin<span class="token punctuation">..=</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;-- all&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n&gt; Test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">speedy<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Readable</span><span class="token punctuation">,</span> <span class="token class-name">Writable</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(PartialEq, Debug, Readable, Writable)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">City</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
  lnglat<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">FromMdbx</span> <span class="token keyword">for</span> <span class="token class-name">City</span> <span class="token punctuation">{</span>
  <span class="token keyword">fn</span> <span class="token function-definition function">from_mdbx</span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> <span class="token class-name">PtrTx</span><span class="token punctuation">,</span> val<span class="token punctuation">:</span> <span class="token class-name">MDBX_val</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
    <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">read_from_buffer</span><span class="token punctuation">(</span><span class="token macro property">val_bytes!</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">ToAsRef</span><span class="token operator">&lt;</span><span class="token class-name">City</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;&gt;</span> <span class="token keyword">for</span> <span class="token class-name">City</span> <span class="token punctuation">{</span>
  <span class="token keyword">fn</span> <span class="token function-definition function">to_as_ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">write_to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span>
  <span class="token class-name">Test</span>
    key <span class="token keyword">u16</span>
    val <span class="token class-name">City</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> city <span class="token operator">=</span> <span class="token class-name">City</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;BeiJing&quot;</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    lnglat<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">11640</span><span class="token punctuation">,</span> <span class="token number">3990</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
  test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> city<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">proc_macro</span><span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">syn</span><span class="token punctuation">;</span>
<span class="token attribute attr-name">#[macro_use]</span>
<span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">quote</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token namespace">proc_macro<span class="token punctuation">::</span></span><span class="token class-name">TokenStream</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[proc_macro_derive(MdbxSpeedy)]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">mdbx_speedy</span><span class="token punctuation">(</span>ts<span class="token punctuation">:</span> <span class="token class-name">TokenStream</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">TokenStream</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> ast<span class="token punctuation">:</span> <span class="token namespace">syn<span class="token punctuation">::</span></span><span class="token class-name">DeriveInput</span> <span class="token operator">=</span> <span class="token namespace">syn<span class="token punctuation">::</span></span><span class="token function">parse</span><span class="token punctuation">(</span>ts<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token operator">&amp;</span>ast<span class="token punctuation">.</span>ident<span class="token punctuation">;</span>
  <span class="token macro property">quote!</span> <span class="token punctuation">{</span>
    <span class="token keyword">impl</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token class-name">FromMdbx</span> <span class="token keyword">for</span> #name <span class="token punctuation">{</span>
      <span class="token keyword">fn</span> <span class="token function-definition function">from_mdbx</span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token class-name">PtrTx</span><span class="token punctuation">,</span> val<span class="token punctuation">:</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token class-name">MDBX_val</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">read_from_buffer</span><span class="token punctuation">(</span><span class="token macro property">val_bytes!</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">impl</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token class-name">ToAsRef</span><span class="token operator">&lt;</span>#name<span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;&gt;</span> <span class="token keyword">for</span> #name <span class="token punctuation">{</span>
      <span class="token keyword">fn</span> <span class="token function-definition function">to_as_ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">write_to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
  <span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div>`,1),Dp=s("Prad\u0117kite nuo "),Ep=n("code",null,"cargo add mdbx-speedy",-1),Bp=s("savo projekte, tada gal\u0117site greitai pritaikyti tip\u0105 (\u017Er. "),Tp={href:"https://github.com/rmw-lib/mdbx-example/blob/master/02/src/main.rs",target:"_blank",rel:"noopener noreferrer"},Mp=s("github.com/rmw-lib/mdbx-example/02"),jp=s(" demonstracin\u012F kod\u0105)."),Np=c(`<div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// I\u0161vesti libmdbx versijos numer\u012F</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Daugiasluoksnis skaitymas ir ra\u0161ymas</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
    sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
      <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
      sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// Per 1/65536 sekund\u0117s dal\u012F</span>
      sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
      max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
          <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
        <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
 <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintamasis pavadinimas Env</span>
 <span class="token class-name">Test</span> <span class="token comment">// Duomen\u0173 baz\u0117s testas</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
 <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> t<span class="token punctuation">:</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Duomen\u0173 baz\u0117s kintam\u0173j\u0173 pavadinimai ENV</span>
  <span class="token class-name">Test1</span>
  <span class="token class-name">Test2</span>
    key <span class="token class-name">Str</span>
    val <span class="token class-name">Str</span>
  <span class="token class-name">Test3</span>
    key <span class="token keyword">i32</span>
    val <span class="token keyword">u64</span>
  <span class="token class-name">Test4</span>
    key <span class="token keyword">u64</span>
    val <span class="token keyword">u16</span>
    flag <span class="token constant">DUPSORT</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Greitas ra\u0161ymas</span>
  <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Greitas skaitymas</span>
  <span class="token keyword">match</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>get <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;\\nu16::from_le_bytes({:?}) = {}&quot;</span><span class="token punctuation">,</span>
        r<span class="token punctuation">,</span>
        <span class="token keyword">u16</span><span class="token punctuation">::</span><span class="token function">from_le_bytes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Kelios operacijos keliose duomen\u0173 baz\u0117se per t\u0105 pa\u010Di\u0105 operacij\u0105</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>

    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test2 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test3 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test3</span><span class="token punctuation">;</span>

    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test3 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test4 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test4</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n-- loop test4 rev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">rev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">dup</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;dup(16) {:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Sandoris bus \u012Fvykdytas pasibaigus taikymo sri\u010Diai</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token class-name">Test2</span>
  key <span class="token class-name">Str</span>
  val <span class="token class-name">Str</span>
<span class="token class-name">Test3</span>
  key <span class="token keyword">i32</span>
  val <span class="token keyword">u64</span>
<span class="token class-name">Test4</span>
  key <span class="token keyword">u64</span>
  val <span class="token keyword">u16</span>
  flag <span class="token constant">DUPSORT</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span>
  <span class="token class-name">Test0</span>
  <span class="token class-name">Test1</span>
    key <span class="token keyword">u16</span>
    val <span class="token keyword">u64</span>
    flag <span class="token constant">DUPSORT</span>
  <span class="token class-name">Test2</span>
    key <span class="token keyword">u32</span>
    val <span class="token keyword">u64</span>
<span class="token punctuation">}</span>

<span class="token macro property">macro_rules!</span> range_rev <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ident</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n# {}.rev_range({:?})&quot;</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$var</span><span class="token punctuation">.</span><span class="token function">range_rev</span><span class="token punctuation">(</span><span class="token variable">$range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property">macro_rules!</span> range <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ident</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n# {}.range({:?})&quot;</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$var</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token variable">$range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n&gt; Test0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test0 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test0</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">range!</span><span class="token punctuation">(</span>test0<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> begin<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test0<span class="token punctuation">,</span> begin<span class="token punctuation">..=</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;-- all&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\\n&gt; Test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">speedy<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Readable</span><span class="token punctuation">,</span> <span class="token class-name">Writable</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(PartialEq, Debug, Readable, Writable)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">City</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
  lnglat<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">FromMdbx</span> <span class="token keyword">for</span> <span class="token class-name">City</span> <span class="token punctuation">{</span>
  <span class="token keyword">fn</span> <span class="token function-definition function">from_mdbx</span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> <span class="token class-name">PtrTx</span><span class="token punctuation">,</span> val<span class="token punctuation">:</span> <span class="token class-name">MDBX_val</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
    <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">read_from_buffer</span><span class="token punctuation">(</span><span class="token macro property">val_bytes!</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">ToAsRef</span><span class="token operator">&lt;</span><span class="token class-name">City</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;&gt;</span> <span class="token keyword">for</span> <span class="token class-name">City</span> <span class="token punctuation">{</span>
  <span class="token keyword">fn</span> <span class="token function-definition function">to_as_ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">write_to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span>
  <span class="token class-name">Test</span>
    key <span class="token keyword">u16</span>
    val <span class="token class-name">City</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> city <span class="token operator">=</span> <span class="token class-name">City</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;BeiJing&quot;</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    lnglat<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">11640</span><span class="token punctuation">,</span> <span class="token number">3990</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
  test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> city<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">proc_macro</span><span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">syn</span><span class="token punctuation">;</span>
<span class="token attribute attr-name">#[macro_use]</span>
<span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">quote</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token namespace">proc_macro<span class="token punctuation">::</span></span><span class="token class-name">TokenStream</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[proc_macro_derive(MdbxSpeedy)]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">mdbx_speedy</span><span class="token punctuation">(</span>ts<span class="token punctuation">:</span> <span class="token class-name">TokenStream</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">TokenStream</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> ast<span class="token punctuation">:</span> <span class="token namespace">syn<span class="token punctuation">::</span></span><span class="token class-name">DeriveInput</span> <span class="token operator">=</span> <span class="token namespace">syn<span class="token punctuation">::</span></span><span class="token function">parse</span><span class="token punctuation">(</span>ts<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token operator">&amp;</span>ast<span class="token punctuation">.</span>ident<span class="token punctuation">;</span>
  <span class="token macro property">quote!</span> <span class="token punctuation">{</span>
    <span class="token keyword">impl</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token class-name">FromMdbx</span> <span class="token keyword">for</span> #name <span class="token punctuation">{</span>
      <span class="token keyword">fn</span> <span class="token function-definition function">from_mdbx</span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token class-name">PtrTx</span><span class="token punctuation">,</span> val<span class="token punctuation">:</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token class-name">MDBX_val</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">read_from_buffer</span><span class="token punctuation">(</span><span class="token macro property">val_bytes!</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">impl</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token class-name">ToAsRef</span><span class="token operator">&lt;</span>#name<span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;&gt;</span> <span class="token keyword">for</span> #name <span class="token punctuation">{</span>
      <span class="token keyword">fn</span> <span class="token function-definition function">to_as_ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">write_to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
  <span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx_speedy<span class="token punctuation">::</span></span><span class="token class-name">MdbxSpeedy</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">speedy<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Readable</span><span class="token punctuation">,</span> <span class="token class-name">Writable</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(PartialEq, Debug, Readable, Writable, MdbxSpeedy)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">City</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
  lnglat<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div>`,1),zp=s("\u017Dinoma, vis tiek erzina nuolat ra\u0161yti "),Sp=n("code",null,"#[derive(PartialEq, Debug, Readable, Writable, MdbxSpeedy)]",-1),Xp=s(", tod\u0117l galite naudoti "),Rp={href:"https://docs.rs/derive-alias/0.1.0/derive_alias",target:"_blank",rel:"noopener noreferrer"},Cp=n("code",null,"derive_alias",-1),Op=s(" dar labiau supaprastinti kod\u0105."),Vp=c('<h2 id="pastaba-del-naudojimo" tabindex="-1"><a class="header-anchor" href="#pastaba-del-naudojimo" aria-hidden="true">#</a> Pastaba d\u0117l naudojimo</h2><h3 id="rakto-ilgis" tabindex="-1"><a class="header-anchor" href="#rakto-ilgis" aria-hidden="true">#</a> Rakto ilgis</h3><ul><li>Ma\u017Eiausias 0, did\u017Eiausias \u2248 \xBD puslapio dydis (pagal nutyl\u0117jim\u0105 4K puslapio rakto did\u017Eiausias dydis yra 2022 baitai), nustatomas inicializuojant duomen\u0173 baz\u0119 <code>pagesize</code> gali b\u016Bti konfig\u016Bruojamas ne didesnis kaip <code>65536</code>ir turi b\u016Bti lygus 2 galiai.</li></ul><h2 id="pastabos" tabindex="-1"><a class="header-anchor" href="#pastabos" aria-hidden="true">#</a> Pastabos</h2><p>Jie nurodo per\u0117jimo nuo LMDB prie MDBX privalumus.</p>',5),Ip=n("p",null,'"Erigon" prad\u0117jo nuo BoltDB duomen\u0173 baz\u0117s, v\u0117liau prid\u0117jo BadgerDB palaikym\u0105 ir galiausiai visi\u0161kai per\u0117jo prie LMDB. tam tikru metu susid\u016Br\u0117me su stabilumo problemomis, kurias suk\u0117l\u0117 LMDB naudojimas ir kuri\u0173 k\u016Br\u0117jai nenumat\u0117. Nuo to laiko mes stebime gerai palaikom\u0105 LMDB i\u0161vestin\u0119, vadinam\u0105 MDBX, ir tikim\u0117s pasinaudoti j\u0173 stabilumo patobulinimais bei galb\u016Bt ateityje daugiau bendradarbiauti.MDBX integravimas dabar baigtas, at\u0117jo laikas atlikti daugiau bandym\u0173 ir rengti dokumentacij\u0105.',-1),Pp=n("p",null,"Per\u0117jimo nuo LMDB prie MDBX privalumai.",-1),Up=n("li",null,[n("p",null,'Duomen\u0173 baz\u0117s fail\u0173 augimas "erdv\u0117 (geometrija)" veikia tinkamai. Tai svarbu, ypa\u010D "Windows" sistemoje. LMDB reikia vien\u0105 kart\u0105 i\u0161 anksto nurodyti atminties \u017Eem\u0117lapio dyd\u012F (\u0161iuo metu pagal nutyl\u0117jim\u0105 naudojame 2 Tb), o jei duomen\u0173 baz\u0117s failas per\u017Eengia \u0161i\u0105 rib\u0105, proces\u0105 reikia paleisti i\u0161 naujo. "Windows" sistemoje nusta\u010Dius 2 TB atminties \u017Eem\u0117lapio dyd\u012F, duomen\u0173 baz\u0117s failas i\u0161 prad\u017Ei\u0173 b\u016Bt\u0173 2 TB dyd\u017Eio, o tai n\u0117ra labai patogu. MDBX atminties \u017Eem\u0117lapio dydis didinamas po 2 Gb. Tai rei\u0161kia, kad retkar\u010Diais reikia pertvarkyti, ta\u010Diau tai u\u017Etikrina geresn\u0119 naudotojo patirt\u012F.')],-1),Ap=n("li",null,[n("p",null,[s("MDBX grie\u017E\u010Diau tikrina, ar tuo pa\u010Diu metu naudojamas sandori\u0173 apdorojimas ir ar nesikartoja skaitymo ir ra\u0161ymo sandoriai toje pa\u010Dioje vykdymo gijoje. Tai leid\u017Eia pasteb\u0117ti kai kurias neakivaizd\u017Eias klaidas ir padaro elges\u012F labiau nusp\u0117jam\u0105."),n("br"),s(" Per daugiau nei penkerius metus (nuo tada, kai buvo atskirta nuo LMDB) MDBX sukaup\u0117 daug saugumo patais\u0173 ir klaid\u0173, kurios, m\u016Bs\u0173 \u017Einiomis, vis dar egzistuoja LMDB. Kai kurios i\u0161 j\u0173 buvo aptiktos m\u016Bs\u0173 bandym\u0173 metu, o MDBX pri\u017Ei\u016Br\u0117tojai rimtai \u012F jas atsi\u017Evelg\u0117 ir nedelsdami i\u0161tais\u0117.")])],-1),Lp=s('Duomen\u0173 baz\u0117se, kuriose nuolat kei\u010Diami duomenys, susidaro nema\u017Eai atstatomos vietos (LMDB terminologijoje dar vadinamos "laisvuoju s\u0105ra\u0161u"). Tur\u0117jome i\u0161taisyti LMDB, kad i\u0161taisytume rim\u010Diausius atkuriamos vietos tvarkymo ( '),Fp={href:"https://github.com/ledgerwatch/erigon/wiki/LMDB-freelist-illustrated-guide",target:"_blank",rel:"noopener noreferrer"},$p=s("analiz\u0117s"),Gp=s(" ) tr\u016Bkumus. MDBX skyr\u0117 "),Kp={href:"https://github.com/ledgerwatch/erigon/wiki/LMDB-freelist-illustrated-guide%EF%BC%89%E3%80%82MDBX%E5%AF%B9%E5%8F%AF%E5%9B%9E%E6%94%B6%E7%A9%BA%E9%97%B4%E7%9A%84%E6%9C%89%E6%95%88%E5%A4%84%E7%90%86%E8%BF%9B%E8%A1%8C%E4%BA%86%E7%89%B9%E5%88%AB%E7%9A%84%E5%85%B3%E6%B3%A8%EF%BC%8C%E5%88%B0%E7%9B%AE%E5%89%8D%E4%B8%BA%E6%AD%A2%EF%BC%8C%E8%BF%98%E4%B8%8D%E9%9C%80%E8%A6%81%E6%89%93%E8%A1%A5%E4%B8%81%E3%80%82",target:"_blank",rel:"noopener noreferrer"},Yp=s("ypating\u0105 d\u0117mes\u012F veiksmingam atkuriamos vietos tvarkymui ir iki \u0161iol jo nereik\u0117jo taisyti"),Hp=s("."),Jp=n("li",null,[n("p",null,"Remiantis m\u016Bs\u0173 bandymais, MDBX \u0161iek tiek geriau atliko m\u016Bs\u0173 darbo kr\u016Bvius.")],-1),Wp=n("li",null,[n("p",null,'MDBX atskleid\u017Eia daugiau vidini\u0173 telemetrijos duomen\u0173 - daugiau metrik\u0173 apie tai, kas vyksta duomen\u0173 baz\u0117je. \u0160iuos duomenis turime "Grafana" - kad gal\u0117tume priimti geresnius sprendimus d\u0117l taikomosios programos dizaino. Pavyzd\u017Eiui, visi\u0161kai per\u0117jus prie MDBX (panaikinus LMDB palaikym\u0105), \u012Fgyvendinsime "pusiau pilno sandorio patvirtinimo" politik\u0105, kad b\u016Bt\u0173 i\u0161vengta disko kontakt\u0173 perpildymo/neperpildymo. Tai dar labiau supaprastins m\u016Bs\u0173 kod\u0105, ta\u010Diau netur\u0117s \u012Ftakos na\u0161umui.')],-1),Qp=n("li",null,[n("p",null,'MDBX palaiko "Exclusive open" re\u017Eim\u0105 - j\u012F naudojame duomen\u0173 bazi\u0173 perk\u0117limui, kad jokie kiti skaitytuvai negal\u0117t\u0173 pasiekti duomen\u0173 baz\u0117s perk\u0117limo proceso metu.')],-1),Zp=n("hr",{class:"footnotes-sep"},null,-1),no={class:"footnotes"},so={class:"footnotes-list"},ao={id:"fn1",class:"footnote-item"},to={href:"https://github.com/ledgerwatch/erigon/wiki/Criteria-for-transitioning-from-Alpha-to-Beta#switch-from-lmdb-to-mdbx",target:"_blank",rel:"noopener noreferrer"},po=s("Erigon (naujos kartos Ethernet klientas) neseniai per\u0117jo nuo LMDB prie MDBX"),oo=s(". "),co=n("a",{href:"#fnref1",class:"footnote-backref"},"\u21A9\uFE0E",-1);function eo(uo,lo){const t=e("ExternalLinkIcon"),p=e("RouterLink");return l(),k(i,null,[m,n("p",null,[d,b,n("a",y,[g,a(t)]),f]),_,w,n("nav",h,[n("ul",null,[n("li",null,[a(p,{to:"#citatos"},{default:o(()=>[v]),_:1})]),n("li",null,[a(p,{to:"#kas-yra-libmdbx"},{default:o(()=>[x]),_:1})]),n("li",null,[a(p,{to:"#pamokos"},{default:o(()=>[q]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#kaip-paleisti-pavyzdi"},{default:o(()=>[D]),_:1})]),n("li",null,[a(p,{to:"#_1-pavyzdys-rasymas-set-key-val-ir-skaitymas-get-key"},{default:o(()=>[E]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#kodas"},{default:o(()=>[B]),_:1})]),n("li",null,[a(p,{to:"#paleisti-isvesti"},{default:o(()=>[T]),_:1})]),n("li",null,[a(p,{to:"#kodo-aprasymas"},{default:o(()=>[M]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#env-rw-duomenu-bazes-apibrezimas"},{default:o(()=>[j]),_:1})]),n("li",null,[a(p,{to:"#makroaplinkos-pletra"},{default:o(()=>[N]),_:1})]),n("li",null,[a(p,{to:"#anyhow-ir-lazy-static"},{default:o(()=>[z]),_:1})]),n("li",null,[a(p,{to:"#makro-mdbx"},{default:o(()=>[S]),_:1})]),n("li",null,[a(p,{to:"#siulai-ir-sandoriai"},{default:o(()=>[X]),_:1})]),n("li",null,[a(p,{to:"#dvejetainiu-duomenu-skaitymas-ir-rasymas"},{default:o(()=>[R]),_:1})])])])])]),n("li",null,[a(p,{to:"#_2-pavyzdys-duomenu-tipai-duomenu-bazes-zymos-istrynimas-narsymas"},{default:o(()=>[C]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#kodas-1"},{default:o(()=>[O]),_:1})]),n("li",null,[a(p,{to:"#paleisti-isvesti-1"},{default:o(()=>[V]),_:1})]),n("li",null,[a(p,{to:"#greitas-skaitymas-ir-rasymas"},{default:o(()=>[I]),_:1})]),n("li",null,[a(p,{to:"#duomenu-tipai"},{default:o(()=>[P]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#is-anksto-nustatyti-duomenu-tipai"},{default:o(()=>[U]),_:1})])])]),n("li",null,[a(p,{to:"#duomenu-bazes-veliavos"},{default:o(()=>[A]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#dupsort-vienas-raktas-atitinka-daugiau-nei-viena-reiksme"},{default:o(()=>[L]),_:1})]),n("li",null,[a(p,{to:"#dup-key-iteratorius-kuris-grazina-visas-rakta-atitinkancias-reiksmes"},{default:o(()=>[F]),_:1})]),n("li",null,[a(p,{to:"#numatytuoju-atveju-automatiskai-pridedamos-duomenu-bazes-veliaveles"},{default:o(()=>[$]),_:1})])])]),n("li",null,[a(p,{to:"#duomenu-salinimas"},{default:o(()=>[G]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#del-key-klaviso-pasalinimas"},{default:o(()=>[K]),_:1})]),n("li",null,[a(p,{to:"#del-val-key-val-tikslaus-atitikmens-istrynimas"},{default:o(()=>[Y]),_:1})])])]),n("li",null,[a(p,{to:"#narsymas"},{default:o(()=>[H]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#nuoseklioji-apziura"},{default:o(()=>[J]),_:1})]),n("li",null,[a(p,{to:"#rev-atvirkstines-tvarkos-narsymas"},{default:o(()=>[W]),_:1})]),n("li",null,[a(p,{to:"#rusiavimas"},{default:o(()=>[Q]),_:1})])])])])]),n("li",null,[a(p,{to:"#intervaliniai-iteratoriai"},{default:o(()=>[Z]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#paleiskite-isvesti"},{default:o(()=>[nn]),_:1})]),n("li",null,[a(p,{to:"#range-begin-end-intervalo-iteracija"},{default:o(()=>[sn]),_:1})]),n("li",null,[a(p,{to:"#rev-range-apversti-intervalai"},{default:o(()=>[an]),_:1})])])]),n("li",null,[a(p,{to:"#duomenu-tipu-pritaikymas"},{default:o(()=>[tn]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#pasirinktiniu-tipu-supaprastinimas-naudojant-atributu-makrokomandas"},{default:o(()=>[pn]),_:1})])])])])]),n("li",null,[a(p,{to:"#pastaba-del-naudojimo"},{default:o(()=>[on]),_:1}),n("ul",null,[n("li",null,[a(p,{to:"#rakto-ilgis"},{default:o(()=>[cn]),_:1})])])]),n("li",null,[a(p,{to:"#pastabos"},{default:o(()=>[en]),_:1})])])]),un,ln,n("p",null,[kn,n("a",rn,[mn,a(t)]),dn]),bn,n("p",null,[yn,n("a",gn,[fn,a(t)]),_n]),wn,hn,n("p",null,[vn,xn,qn,n("a",Dn,[En,a(t)]),Bn,Tn,Mn,n("a",jn,[Nn,a(t)]),zn]),Sn,n("p",null,[n("a",Xn,[Rn,a(t)]),Cn,n("a",On,[Vn,a(t)]),In]),n("p",null,[n("a",Pn,[Un,a(t)]),An]),n("p",null,[Ln,n("a",Fn,[$n,a(t)]),Gn]),n("p",null,[n("a",Kn,[Yn,a(t)]),Hn]),n("p",null,[n("a",Jn,[Wn,a(t)]),Qn]),Zn,n("p",null,[ns,n("a",ss,[as,a(t)]),ts,n("a",ps,[os,a(t)]),cs,es,us]),ls,n("p",null,[ks,n("a",is,[rs,a(t)])]),ms,n("ol",null,[ds,n("li",null,[n("p",null,[bs,n("a",ys,[gs,a(t)]),fs])])]),_s,n("p",null,[ws,hs,n("a",vs,[xs,a(t)]),qs]),n("p",null,[Ds,n("a",Es,[Bs,a(t)]),Ts]),Ms,n("p",null,[n("a",js,[Ns,a(t)]),zs]),n("p",null,[n("a",Ss,[Xs,a(t)]),Rs]),Cs,Os,n("p",null,[n("a",Vs,[Is,a(t)]),Ps,n("a",Us,[As,a(t)]),Ls]),Fs,n("p",null,[$s,Gs,Ks,Ys,n("a",Hs,[Js,a(t)]),Ws]),Qs,Zs,n("p",null,[na,n("a",sa,[aa,a(t)]),ta]),pa,n("p",null,[oa,n("a",ca,[ea,a(t)])]),ua,n("p",null,[la,n("a",ka,[ia,a(t)]),ra]),ma,n("p",null,[da,n("a",ba,[ya,a(t)]),ga,fa,_a]),n("p",null,[wa,ha,va,n("a",xa,[qa,a(t)]),Da]),n("p",null,[n("a",Ea,[Ba,a(t)]),Ta,Ma,ja,Na,za]),n("p",null,[Sa,Xa,Ra,n("a",Ca,[Oa,a(t)]),Va,Ia,Pa]),Ua,n("p",null,[Aa,La,Fa,$a,Ga,n("a",Ka,[Ya,a(t)]),Ha]),Ja,n("p",null,[Wa,n("a",Qa,[Za,a(t)]),nt,st,at,tt]),n("p",null,[pt,n("a",ot,[ct,a(t)]),et]),ut,n("p",null,[lt,kt,it,rt,mt,dt,bt,n("a",yt,[gt,a(t)]),ft]),n("p",null,[_t,n("a",wt,[ht,a(t)]),vt]),xt,n("p",null,[qt,n("a",Dt,[Et,a(t)]),Bt]),Tt,Mt,jt,Nt,n("p",null,[zt,n("a",St,[Xt,a(t)]),Rt]),Ct,n("p",null,[Ot,n("a",Vt,[It,a(t)]),Pt,Ut,At,Lt,Ft]),$t,n("p",null,[Gt,n("a",Kt,[Yt,a(t)]),Ht]),Jt,n("p",null,[Wt,n("a",Qt,[Zt,a(t)]),np,n("a",sp,[ap,tp,pp,a(t)]),op]),n("p",null,[cp,n("a",ep,[up,a(t)]),lp,n("a",kp,[ip,a(t)]),rp,mp,dp]),n("p",null,[bp,n("a",yp,[gp,a(t)]),fp]),_p,n("p",null,[wp,n("a",hp,[vp,a(t)]),xp]),qp,n("p",null,[Dp,Ep,Bp,n("a",Tp,[Mp,a(t)]),jp]),Np,n("p",null,[zp,Sp,Xp,n("a",Rp,[Cp,a(t)]),Op]),Vp,n("blockquote",null,[Ip,Pp,n("ol",null,[Up,Ap,n("li",null,[n("p",null,[Lp,n("a",Fp,[$p,a(t)]),Gp,n("a",Kp,[Yp,a(t)]),Hp])]),Jp,Wp,Qp])]),Zp,n("section",no,[n("ol",so,[n("li",ao,[n("p",null,[n("a",to,[po,a(t)]),oo,co])])])])],64)}var io=u(r,[["render",eo],["__file","2021-12-21-mdbx.html.vue"]]);export{io as default};
