<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.38">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>Het roestpakket voor libmdbx | rmw.link</title><meta name="description" content="Weg met de data-hegemonie · Cyberland Revolutie">
    <link rel="modulepreload" href="/assets/app.2533875a.js"><link rel="modulepreload" href="/assets/2021-12-21-mdbx.html.a01d7404.js"><link rel="modulepreload" href="/assets/2021-12-21-mdbx.html.5a6ddc51.js">
    <link rel="stylesheet" href="/assets/style.7080ebca.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="Schakel zijbalk" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/nl" class=""><img class="logo" src="/ico.svg" alt="rmw.link"><span class="site-name can-hide">rmw.link</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Chatroom"><span class="title">Chatroom</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Chatroom"><span class="title">Chatroom</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://rmw.zulipchat.com" rel="noopener noreferrer" target="_blank" aria-label="Webversie"><!--[--><!--]--> Webversie <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://rmw.zulipchat.com/apps" rel="noopener noreferrer" target="_blank" aria-label="Klanten"><!--[--><!--]--> Klanten <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="lang"><span class="title"></span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="lang"><span class="title"></span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/zh/log/2021-12-21-mdbx.html" class="" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/en/log/2021-12-21-mdbx.html" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ja/log/2021-12-21-mdbx.html" class="" aria-label="日本語"><!--[--><!--]--> 日本語 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/pt/log/2021-12-21-mdbx.html" class="" aria-label="Português"><!--[--><!--]--> Português <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/de/log/2021-12-21-mdbx.html" class="" aria-label="Deutsch"><!--[--><!--]--> Deutsch <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ru/log/2021-12-21-mdbx.html" class="" aria-label="Русский"><!--[--><!--]--> Русский <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/it/log/2021-12-21-mdbx.html" class="" aria-label="Italiano"><!--[--><!--]--> Italiano <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/log/2021-12-21-mdbx.html" class="" aria-label="Español"><!--[--><!--]--> Español <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/bg/log/2021-12-21-mdbx.html" class="" aria-label="Български"><!--[--><!--]--> Български <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/cs/log/2021-12-21-mdbx.html" class="" aria-label="Česky"><!--[--><!--]--> Česky <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/da/log/2021-12-21-mdbx.html" class="" aria-label="Dansk"><!--[--><!--]--> Dansk <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/el/log/2021-12-21-mdbx.html" class="" aria-label="Ελληνική"><!--[--><!--]--> Ελληνική <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/et/log/2021-12-21-mdbx.html" class="" aria-label="Eesti"><!--[--><!--]--> Eesti <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fi/log/2021-12-21-mdbx.html" class="" aria-label="Suomalainen"><!--[--><!--]--> Suomalainen <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fr/log/2021-12-21-mdbx.html" class="" aria-label="Français"><!--[--><!--]--> Français <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/hu/log/2021-12-21-mdbx.html" class="" aria-label="Magyar"><!--[--><!--]--> Magyar <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lt/log/2021-12-21-mdbx.html" class="" aria-label="Lietuvių kalba"><!--[--><!--]--> Lietuvių kalba <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lv/log/2021-12-21-mdbx.html" class="" aria-label="Latviešu"><!--[--><!--]--> Latviešu <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Nederlands"><!--[--><!--]--> Nederlands <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/pl/log/2021-12-21-mdbx.html" class="" aria-label="Polski"><!--[--><!--]--> Polski <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ro/log/2021-12-21-mdbx.html" class="" aria-label="Românesc"><!--[--><!--]--> Românesc <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/sk/log/2021-12-21-mdbx.html" class="" aria-label="Slovensky"><!--[--><!--]--> Slovensky <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/sl/log/2021-12-21-mdbx.html" class="" aria-label="Slovenski"><!--[--><!--]--> Slovenski <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/sv/log/2021-12-21-mdbx.html" class="" aria-label="Svenska"><!--[--><!--]--> Svenska <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><!----><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Chatroom"><span class="title">Chatroom</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Chatroom"><span class="title">Chatroom</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="external-link" href="https://rmw.zulipchat.com" rel="noopener noreferrer" target="_blank" aria-label="Webversie"><!--[--><!--]--> Webversie <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://rmw.zulipchat.com/apps" rel="noopener noreferrer" target="_blank" aria-label="Klanten"><!--[--><!--]--> Klanten <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="lang"><span class="title"></span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="lang"><span class="title"></span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/zh/log/2021-12-21-mdbx.html" class="" aria-label="简体中文"><!--[--><!--]--> 简体中文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/en/log/2021-12-21-mdbx.html" class="" aria-label="English"><!--[--><!--]--> English <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ja/log/2021-12-21-mdbx.html" class="" aria-label="日本語"><!--[--><!--]--> 日本語 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/pt/log/2021-12-21-mdbx.html" class="" aria-label="Português"><!--[--><!--]--> Português <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/de/log/2021-12-21-mdbx.html" class="" aria-label="Deutsch"><!--[--><!--]--> Deutsch <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ru/log/2021-12-21-mdbx.html" class="" aria-label="Русский"><!--[--><!--]--> Русский <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/it/log/2021-12-21-mdbx.html" class="" aria-label="Italiano"><!--[--><!--]--> Italiano <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/es/log/2021-12-21-mdbx.html" class="" aria-label="Español"><!--[--><!--]--> Español <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/bg/log/2021-12-21-mdbx.html" class="" aria-label="Български"><!--[--><!--]--> Български <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/cs/log/2021-12-21-mdbx.html" class="" aria-label="Česky"><!--[--><!--]--> Česky <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/da/log/2021-12-21-mdbx.html" class="" aria-label="Dansk"><!--[--><!--]--> Dansk <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/el/log/2021-12-21-mdbx.html" class="" aria-label="Ελληνική"><!--[--><!--]--> Ελληνική <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/et/log/2021-12-21-mdbx.html" class="" aria-label="Eesti"><!--[--><!--]--> Eesti <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fi/log/2021-12-21-mdbx.html" class="" aria-label="Suomalainen"><!--[--><!--]--> Suomalainen <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/fr/log/2021-12-21-mdbx.html" class="" aria-label="Français"><!--[--><!--]--> Français <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/hu/log/2021-12-21-mdbx.html" class="" aria-label="Magyar"><!--[--><!--]--> Magyar <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lt/log/2021-12-21-mdbx.html" class="" aria-label="Lietuvių kalba"><!--[--><!--]--> Lietuvių kalba <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/lv/log/2021-12-21-mdbx.html" class="" aria-label="Latviešu"><!--[--><!--]--> Latviešu <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html" class="router-link-active router-link-exact-active router-link-active" aria-label="Nederlands"><!--[--><!--]--> Nederlands <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/pl/log/2021-12-21-mdbx.html" class="" aria-label="Polski"><!--[--><!--]--> Polski <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/ro/log/2021-12-21-mdbx.html" class="" aria-label="Românesc"><!--[--><!--]--> Românesc <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/sk/log/2021-12-21-mdbx.html" class="" aria-label="Slovensky"><!--[--><!--]--> Slovensky <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/sl/log/2021-12-21-mdbx.html" class="" aria-label="Slovenski"><!--[--><!--]--> Slovenski <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/sv/log/2021-12-21-mdbx.html" class="" aria-label="Svenska"><!--[--><!--]--> Svenska <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/nl/" class="router-link-active sidebar-item sidebar-heading" aria-label="Proloog"><!--[--><!--]--> Proloog <!--[--><!--]--></a><!----></li><li><a href="/nl/link.html" class="sidebar-item sidebar-heading" aria-label="Open Source Bibliotheek"><!--[--><!--]--> Open Source Bibliotheek <!--[--><!--]--></a><!----></li><li><a href="/nl/log" class="router-link-active sidebar-item sidebar-heading active" aria-label="Opmerkingen"><!--[--><!--]--> Opmerkingen <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="Het roestpakket voor libmdbx"><!--[--><!--]--> Het roestpakket voor libmdbx <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#citaten" class="router-link-active router-link-exact-active sidebar-item" aria-label="Citaten"><!--[--><!--]--> Citaten <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#wat-is-libmdbx" class="router-link-active router-link-exact-active sidebar-item" aria-label="Wat is libmdbx?"><!--[--><!--]--> Wat is libmdbx? <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#tutorials" class="router-link-active router-link-exact-active sidebar-item" aria-label="Tutorials"><!--[--><!--]--> Tutorials <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#hoe-het-voorbeeld-uit-te-voeren" class="router-link-active router-link-exact-active sidebar-item" aria-label="Hoe het voorbeeld uit te voeren"><!--[--><!--]--> Hoe het voorbeeld uit te voeren <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#voorbeeld-1-schrijven-set-key-val-en-lezen-get-key" class="router-link-active router-link-exact-active sidebar-item" aria-label="Voorbeeld 1 : Schrijven set(key,val) en lezen .get(key)"><!--[--><!--]--> Voorbeeld 1 : Schrijven set(key,val) en lezen .get(key) <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#code" class="router-link-active router-link-exact-active sidebar-item" aria-label="Code"><!--[--><!--]--> Code <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#voer-de-uitvoer-uit" class="router-link-active router-link-exact-active sidebar-item" aria-label="Voer de uitvoer uit"><!--[--><!--]--> Voer de uitvoer uit <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#code-omschrijving" class="router-link-active router-link-exact-active sidebar-item" aria-label="Code omschrijving"><!--[--><!--]--> Code omschrijving <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#env-rw-definieren-van-de-database" class="router-link-active router-link-exact-active sidebar-item" aria-label="env_rw! Definiëren van de database"><!--[--><!--]--> env_rw! Definiëren van de database <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#macro-uitbreiding" class="router-link-active router-link-exact-active sidebar-item" aria-label="Macro uitbreiding"><!--[--><!--]--> Macro uitbreiding <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#hoe-dan-ook-en-lazy-static" class="router-link-active router-link-exact-active sidebar-item" aria-label="hoe dan ook en lazy_static"><!--[--><!--]--> hoe dan ook en lazy_static <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#de-macro-mdbx" class="router-link-active router-link-exact-active sidebar-item" aria-label="De macro mdbx!"><!--[--><!--]--> De macro mdbx! <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#draden-en-transacties" class="router-link-active router-link-exact-active sidebar-item" aria-label="Draden en transacties"><!--[--><!--]--> Draden en transacties <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#binaire-gegevens-lezen-en-schrijven" class="router-link-active router-link-exact-active sidebar-item" aria-label="Binaire gegevens lezen en schrijven"><!--[--><!--]--> Binaire gegevens lezen en schrijven <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#voorbeeld-2-datatypes-databaseflags-wissen-traverseren" class="router-link-active router-link-exact-active sidebar-item" aria-label="Voorbeeld 2: Datatypes, databaseflags, wissen, traverseren"><!--[--><!--]--> Voorbeeld 2: Datatypes, databaseflags, wissen, traverseren <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#code-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="Code"><!--[--><!--]--> Code <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#voer-de-uitvoer-uit-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="Voer de uitvoer uit"><!--[--><!--]--> Voer de uitvoer uit <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#snel-lezen-en-schrijven" class="router-link-active router-link-exact-active sidebar-item" aria-label="Snel lezen en schrijven"><!--[--><!--]--> Snel lezen en schrijven <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#gegevenstypen" class="router-link-active router-link-exact-active sidebar-item" aria-label="Gegevenstypen"><!--[--><!--]--> Gegevenstypen <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#vooraf-ingestelde-gegevenstypen" class="router-link-active router-link-exact-active sidebar-item" aria-label="Vooraf ingestelde gegevenstypen"><!--[--><!--]--> Vooraf ingestelde gegevenstypen <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#databank-vlaggen" class="router-link-active router-link-exact-active sidebar-item" aria-label="Databank vlaggen"><!--[--><!--]--> Databank vlaggen <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#dupsort-een-sleutel-komt-overeen-met-meer-dan-een-waarde" class="router-link-active router-link-exact-active sidebar-item" aria-label="DUPSORT : Een sleutel komt overeen met meer dan een waarde"><!--[--><!--]--> DUPSORT : Een sleutel komt overeen met meer dan een waarde <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#dup-key-iterator-die-alle-waarden-teruggeeft-die-corresponderen-met-een-sleutel" class="router-link-active router-link-exact-active sidebar-item" aria-label=".dup(key) iterator die alle waarden teruggeeft die corresponderen met een sleutel"><!--[--><!--]--> .dup(key) iterator die alle waarden teruggeeft die corresponderen met een sleutel <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#standaard-automatisch-toegevoegde-databankvlaggen" class="router-link-active router-link-exact-active sidebar-item" aria-label="Standaard automatisch toegevoegde databankvlaggen"><!--[--><!--]--> Standaard automatisch toegevoegde databankvlaggen <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#gegevens-verwijderen" class="router-link-active router-link-exact-active sidebar-item" aria-label="Gegevens verwijderen"><!--[--><!--]--> Gegevens verwijderen <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#del-key-een-toets-verwijderen" class="router-link-active router-link-exact-active sidebar-item" aria-label=".del(key) Een toets verwijderen"><!--[--><!--]--> .del(key) Een toets verwijderen <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#del-val-key-val-exacte-overeenkomst-wissen" class="router-link-active router-link-exact-active sidebar-item" aria-label=".del_val(key,val) Exacte overeenkomst wissen"><!--[--><!--]--> .del_val(key,val) Exacte overeenkomst wissen <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#traversal" class="router-link-active router-link-exact-active sidebar-item" aria-label="Traversal"><!--[--><!--]--> Traversal <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#sequentiele-traversal" class="router-link-active router-link-exact-active sidebar-item" aria-label="sequentiële traversal"><!--[--><!--]--> sequentiële traversal <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#rev-omgekeerde-volgorde-traversal" class="router-link-active router-link-exact-active sidebar-item" aria-label=".rev() Omgekeerde volgorde traversal"><!--[--><!--]--> .rev() Omgekeerde volgorde traversal <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#sorteren" class="router-link-active router-link-exact-active sidebar-item" aria-label="Sorteren"><!--[--><!--]--> Sorteren <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#interval-iteratoren" class="router-link-active router-link-exact-active sidebar-item" aria-label="Interval iteratoren"><!--[--><!--]--> Interval iteratoren <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#voer-de-uitvoer-van" class="router-link-active router-link-exact-active sidebar-item" aria-label="Voer de uitvoer van"><!--[--><!--]--> Voer de uitvoer van <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#range-begin-end-interval-iteratie" class="router-link-active router-link-exact-active sidebar-item" aria-label=".range(begin..end) Interval Iteratie"><!--[--><!--]--> .range(begin..end) Interval Iteratie <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#rev-range-omgekeerde-intervallen" class="router-link-active router-link-exact-active sidebar-item" aria-label=".rev_range Omgekeerde intervallen"><!--[--><!--]--> .rev_range Omgekeerde intervallen <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#aanpassen-van-gegevenstypen" class="router-link-active router-link-exact-active sidebar-item" aria-label="Aanpassen van gegevenstypen"><!--[--><!--]--> Aanpassen van gegevenstypen <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#aangepaste-types-vereenvoudigen-met-attribuutmacro-s" class="router-link-active router-link-exact-active sidebar-item" aria-label="Aangepaste types vereenvoudigen met attribuutmacro&#39;s"><!--[--><!--]--> Aangepaste types vereenvoudigen met attribuutmacro&#39;s <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#opmerking-over-het-gebruik-van" class="router-link-active router-link-exact-active sidebar-item" aria-label="Opmerking over het gebruik van"><!--[--><!--]--> Opmerking over het gebruik van <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#de-lengte-van-de-sleutel" class="router-link-active router-link-exact-active sidebar-item" aria-label="De lengte van de sleutel"><!--[--><!--]--> De lengte van de sleutel <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#voetnoten" class="router-link-active router-link-exact-active sidebar-item" aria-label="Voetnoten"><!--[--><!--]--> Voetnoten <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/nl/log/2022-06-02-blake3_merkle.html" class="sidebar-item" aria-label="Merkleboom gebaseerd op blake3"><!--[--><!--]--> Merkleboom gebaseerd op blake3 <!--[--><!--]--></a><!----></li><li><a href="/nl/log/2021-12-09-markdown-translate.html" class="sidebar-item" aria-label="markdown vertaalhulpmiddelen"><!--[--><!--]--> markdown vertaalhulpmiddelen <!--[--><!--]--></a><!----></li><li><a href="/nl/log/2021-12-24.tool.html" class="sidebar-item" aria-label="Gemeenschappelijke instrumenten"><!--[--><!--]--> Gemeenschappelijke instrumenten <!--[--><!--]--></a><!----></li><li><a href="/nl/log/2020-11-29-vuepress.html" class="sidebar-item" aria-label="vuepress bouw blog"><!--[--><!--]--> vuepress bouw blog <!--[--><!--]--></a><!----></li><li><a href="/nl/log/2022-04-29-quickjs-rust.html" class="sidebar-item" aria-label="Quickjs aanpassen om roestfuncties te importeren - een nieuwe manier van denken over het uitbreiden van Kraken"><!--[--><!--]--> Quickjs aanpassen om roestfuncties te importeren - een nieuwe manier van denken over het uitbreiden van Kraken <!--[--><!--]--></a><!----></li><li><a href="/nl/log/2022-03-13.vue3-drag.html" class="sidebar-item" aria-label="@rmw/vue3-drag : Een versleepbare, resizable knipseldoos"><!--[--><!--]--> @rmw/vue3-drag : Een versleepbare, resizable knipseldoos <!--[--><!--]--></a><!----></li><li><a href="/nl/log/2021-11-11-rust-android.html" class="sidebar-item" aria-label="Compileren van kiss-ftpd (rust taal programma) voor android set-top box"><!--[--><!--]--> Compileren van kiss-ftpd (rust taal programma) voor android set-top box <!--[--><!--]--></a><!----></li><li><a href="/nl/log/2021-12-20-js.html" class="sidebar-item" aria-label="Mijn node.js gereedschap bibliotheek"><!--[--><!--]--> Mijn node.js gereedschap bibliotheek <!--[--><!--]--></a><!----></li><li><a href="/nl/log/2022-03-14.electron-drag.html" class="sidebar-item" aria-label="electron perfect drag and drop : een elegantere implementatie dan electron-drag"><!--[--><!--]--> electron perfect drag and drop : een elegantere implementatie dan electron-drag <!--[--><!--]--></a><!----></li><li><a href="/nl/log/2020-12-22-rmw-utf8.html" class="sidebar-item" aria-label="rmw-utf8 - utf8 compressie codering"><!--[--><!--]--> rmw-utf8 - utf8 compressie codering <!--[--><!--]--></a><!----></li><li><a href="/nl/log/2022-06-24_tiny_captcha.html" class="sidebar-item" aria-label="tiny_captcha : roest lichtgewicht captcha generator, compileerbaar naar wasm"><!--[--><!--]--> tiny_captcha : roest lichtgewicht captcha generator, compileerbaar naar wasm <!--[--><!--]--></a><!----></li><li><a href="/nl/log/2022-02-09.vlang.html" class="sidebar-item" aria-label="V Notities over het leren van talen"><!--[--><!--]--> V Notities over het leren van talen <!--[--><!--]--></a><!----></li><li><a href="/nl/log/2022-07-20_mdi.html" class="sidebar-item" aria-label="mdi : code insluiten in markdown / versienummer / markdown ..."><!--[--><!--]--> mdi : code insluiten in markdown / versienummer / markdown ... <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="het-roestpakket-voor-libmdbx" tabindex="-1"><a class="header-anchor" href="#het-roestpakket-voor-libmdbx" aria-hidden="true">#</a> Het roestpakket voor libmdbx</h1><p>De <code>rust</code> wrapper voor de <a href="https://github.com/erthink/libmdbx" target="_blank" rel="noopener noreferrer">libmdbx<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> database.</p><hr><p>Directory :</p><nav class="table-of-contents"><ul><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#citaten" class="router-link-active router-link-exact-active">Citaten</a></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#wat-is-libmdbx" class="router-link-active router-link-exact-active">Wat is libmdbx?</a></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#tutorials" class="router-link-active router-link-exact-active">Tutorials</a><ul><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#hoe-het-voorbeeld-uit-te-voeren" class="router-link-active router-link-exact-active">Hoe het voorbeeld uit te voeren</a></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#voorbeeld-1-schrijven-set-key-val-en-lezen-get-key" class="router-link-active router-link-exact-active">Voorbeeld 1 : Schrijven set(key,val) en lezen .get(key)</a><ul><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#code" class="router-link-active router-link-exact-active">Code</a></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#voer-de-uitvoer-uit" class="router-link-active router-link-exact-active">Voer de uitvoer uit</a></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#code-omschrijving" class="router-link-active router-link-exact-active">Code omschrijving</a><ul><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#env-rw-definieren-van-de-database" class="router-link-active router-link-exact-active">env_rw! Definiëren van de database</a></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#macro-uitbreiding" class="router-link-active router-link-exact-active">Macro uitbreiding</a></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#hoe-dan-ook-en-lazy-static" class="router-link-active router-link-exact-active">hoe dan ook en lazy_static</a></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#de-macro-mdbx" class="router-link-active router-link-exact-active">De macro mdbx!</a></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#draden-en-transacties" class="router-link-active router-link-exact-active">Draden en transacties</a></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#binaire-gegevens-lezen-en-schrijven" class="router-link-active router-link-exact-active">Binaire gegevens lezen en schrijven</a></li></ul></li></ul></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#voorbeeld-2-datatypes-databaseflags-wissen-traverseren" class="router-link-active router-link-exact-active">Voorbeeld 2: Datatypes, databaseflags, wissen, traverseren</a><ul><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#code-1" class="router-link-active router-link-exact-active">Code</a></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#voer-de-uitvoer-uit-1" class="router-link-active router-link-exact-active">Voer de uitvoer uit</a></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#snel-lezen-en-schrijven" class="router-link-active router-link-exact-active">Snel lezen en schrijven</a></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#gegevenstypen" class="router-link-active router-link-exact-active">Gegevenstypen</a><ul><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#vooraf-ingestelde-gegevenstypen" class="router-link-active router-link-exact-active">Vooraf ingestelde gegevenstypen</a></li></ul></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#databank-vlaggen" class="router-link-active router-link-exact-active">Databank vlaggen</a><ul><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#dupsort-een-sleutel-komt-overeen-met-meer-dan-een-waarde" class="router-link-active router-link-exact-active">DUPSORT : Een sleutel komt overeen met meer dan een waarde</a></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#dup-key-iterator-die-alle-waarden-teruggeeft-die-corresponderen-met-een-sleutel" class="router-link-active router-link-exact-active">.dup(key) iterator die alle waarden teruggeeft die corresponderen met een sleutel</a></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#standaard-automatisch-toegevoegde-databankvlaggen" class="router-link-active router-link-exact-active">Standaard automatisch toegevoegde databankvlaggen</a></li></ul></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#gegevens-verwijderen" class="router-link-active router-link-exact-active">Gegevens verwijderen</a><ul><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#del-key-een-toets-verwijderen" class="router-link-active router-link-exact-active">.del(key) Een toets verwijderen</a></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#del-val-key-val-exacte-overeenkomst-wissen" class="router-link-active router-link-exact-active">.del_val(key,val) Exacte overeenkomst wissen</a></li></ul></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#traversal" class="router-link-active router-link-exact-active">Traversal</a><ul><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#sequentiele-traversal" class="router-link-active router-link-exact-active">sequentiële traversal</a></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#rev-omgekeerde-volgorde-traversal" class="router-link-active router-link-exact-active">.rev() Omgekeerde volgorde traversal</a></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#sorteren" class="router-link-active router-link-exact-active">Sorteren</a></li></ul></li></ul></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#interval-iteratoren" class="router-link-active router-link-exact-active">Interval iteratoren</a><ul><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#voer-de-uitvoer-van" class="router-link-active router-link-exact-active">Voer de uitvoer van</a></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#range-begin-end-interval-iteratie" class="router-link-active router-link-exact-active">.range(begin..end) Interval Iteratie</a></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#rev-range-omgekeerde-intervallen" class="router-link-active router-link-exact-active">.rev_range Omgekeerde intervallen</a></li></ul></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#aanpassen-van-gegevenstypen" class="router-link-active router-link-exact-active">Aanpassen van gegevenstypen</a><ul><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#aangepaste-types-vereenvoudigen-met-attribuutmacro-s" class="router-link-active router-link-exact-active">Aangepaste types vereenvoudigen met attribuutmacro&#39;s</a></li></ul></li></ul></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#opmerking-over-het-gebruik-van" class="router-link-active router-link-exact-active">Opmerking over het gebruik van</a><ul><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#de-lengte-van-de-sleutel" class="router-link-active router-link-exact-active">De lengte van de sleutel</a></li></ul></li><li><a aria-current="page" href="/nl/log/2021-12-21-mdbx.html#voetnoten" class="router-link-active router-link-exact-active">Voetnoten</a></li></ul></nav><hr><h2 id="citaten" tabindex="-1"><a class="header-anchor" href="#citaten" aria-hidden="true">#</a> Citaten</h2><p>Toen ik <a href="https://rmw.link" target="_blank" rel="noopener noreferrer">&#39;rmw.link<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> &#39; schreef, voelde ik dat ik een ingebedde database nodig had.</p><p>Vanwege de netwerkdoorvoer die nodig is om vaak op te nemen, te lezen en te schrijven, was <code>sqlite3</code> te geavanceerd omwille van de prestaties.</p><p>Dus een lager niveau key-value database was meer geschikt <a href="https://discourse.world/h/2020/06/05/Shine-and-poverty-key-value-database-LMDB-in-applications-for-iOS" target="_blank" rel="noopener noreferrer">(lmdb is 10 keer sneller dan sqlite<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> ).</p><p><img src="//irmw.gumlet.io/yxZV8x.jpg" alt=""></p><p>Uiteindelijk heb ik gekozen voor de magische versie van <code>lmdb</code> - <code>mdbx</code>.</p><p>Momenteel ondersteunt het bestaande <code>rust</code> pakket van <a href="https://github.com/vorot93/mdbx-rs/issues/1" target="_blank" rel="noopener noreferrer">mdbx-rs (mdbx-sys)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> van <code>mdbx</code> <a href="https://github.com/vorot93/mdbx-rs/issues/1" target="_blank" rel="noopener noreferrer">windows niet<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a>, dus nam ik de taak op me om een versie te maken die dat wel doet.</p><p>Ondersteuning voor het opslaan van aangepaste roesttypes. Ondersteunt multi-threaded toegang.</p><p>De database kan worden gedefinieerd in een module met <code>lazy_static</code> en dan eenvoudig worden geïntroduceerd en gebruikt met iets als :</p><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="wat-is-libmdbx" tabindex="-1"><a class="header-anchor" href="#wat-is-libmdbx" aria-hidden="true">#</a> Wat is libmdbx?</h2><p><a href="https://github.com/erthink/libmdbx" target="_blank" rel="noopener noreferrer">mdbx<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> is een secundaire database gebaseerd op lmdb, van de Rus <a href="https://vk.com/erthink" target="_blank" rel="noopener noreferrer">Леонид Юрьев (Leonid Yuriev)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a>.</p><p><a href="https://en.wikipedia.org/wiki/Lightning_Memory-Mapped_Database" target="_blank" rel="noopener noreferrer">lmdb<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> is een supersnelle embedded key-value database.</p><p>De full-text zoekmachine <a href="https://docs.meilisearch.com/reference/under_the_hood/storage.html#measured-disk-usage" target="_blank" rel="noopener noreferrer">MeiliSearch<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> is gebaseerd op lmdb.</p><p><a href="https://docs.nvidia.com/deeplearning/dali/user-guide/docs/examples/general/data_loading/dataloading_lmdb.html" target="_blank" rel="noopener noreferrer">Het deep learning-raamwerk caffe gebruikt ook lmdb als gegevensopslag<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a>.</p><p><a href="https://github.com/erthink/libmdbx#added-features" target="_blank" rel="noopener noreferrer">mdbx is 30% sneller dan lmdb in de embedded performance test benchmark ioarena<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a>.</p><p><img src="https://raw.githubusercontent.com/wiki/erthink/libmdbx/img/perf-slide-1.png" alt=""><br><img src="https://raw.githubusercontent.com/wiki/erthink/libmdbx/img/perf-slide-3.png" alt=""><br><img src="https://raw.githubusercontent.com/wiki/erthink/libmdbx/img/perf-slide-4.png" alt=""><br><img src="https://raw.githubusercontent.com/wiki/erthink/libmdbx/img/perf-slide-5.png" alt=""></p><p>Tegelijkertijd <a href="https://github.com/erthink/libmdbx#improvements-beyond-lmdb" target="_blank" rel="noopener noreferrer">verbetert<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> mdbx <a href="https://github.com/erthink/libmdbx#improvements-beyond-lmdb" target="_blank" rel="noopener noreferrer">veel van de tekortkomingen van<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> lmdb, dus is Erigon (de volgende generatie ethereum client) onlangs overgestapt van LMDB naar MDBX <sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>.</p><h2 id="tutorials" tabindex="-1"><a class="header-anchor" href="#tutorials" aria-hidden="true">#</a> Tutorials</h2><h3 id="hoe-het-voorbeeld-uit-te-voeren" tabindex="-1"><a class="header-anchor" href="#hoe-het-voorbeeld-uit-te-voeren" aria-hidden="true">#</a> Hoe het voorbeeld uit te voeren</h3><p>Kloon eerst de codebase <code>git clone git@github.com:rmw-lib/mdbx.git --depth=1 &amp;&amp; cd mdbx</code></p><p>Start dan <code>cargo run --example 01</code> en het zal <code>examples/01.rs</code></p><p>Als het je eigen project is, draai het dan eerst :</p><div class="language-bash ext-sh"><pre class="language-bash"><code>cargo <span class="token function">install</span> cargo-edit
cargo <span class="token function">add</span> mdbx lazy_static ctor <span class="token function">paste</span>
</code></pre></div><h3 id="voorbeeld-1-schrijven-set-key-val-en-lezen-get-key" tabindex="-1"><a class="header-anchor" href="#voorbeeld-1-schrijven-set-key-val-en-lezen-get-key" aria-hidden="true">#</a> Voorbeeld 1 : Schrijven <code>set(key,val)</code> en lezen <code>.get(key)</code></h3><p>Laten we eens kijken naar een eenvoudig <a href="https://github.com/rmw-lib/mdbx/blob/master/examples/01.rs" target="_blank" rel="noopener noreferrer">voorbeeld/01.rs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a></p><h4 id="code" tabindex="-1"><a class="header-anchor" href="#code" aria-hidden="true">#</a> Code</h4><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Geef het versienummer van libmdbx</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Multi-threaded lezen en schrijven</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="voer-de-uitvoer-uit" tabindex="-1"><a class="header-anchor" href="#voer-de-uitvoer-uit" aria-hidden="true">#</a> Voer de uitvoer uit</h4><div class="language-text ext-text"><pre class="language-text"><code>mdbx file path /Users/z/rmw/mdbx/target/debug/examples/01.mdb
mdbx version https://github.com/erthink/libmdbx/releases/tag/v0.11.2
test1 get Ok(Some(Bin([6])))
[6]
</code></pre></div><h4 id="code-omschrijving" tabindex="-1"><a class="header-anchor" href="#code-omschrijving" aria-hidden="true">#</a> Code omschrijving</h4><h5 id="env-rw-definieren-van-de-database" tabindex="-1"><a class="header-anchor" href="#env-rw-definieren-van-de-database" aria-hidden="true">#</a> <code>env_rw!</code> Definiëren van de database</h5><p>De code begint met een macro env_rw, die 4 parameters heeft.</p><ol><li><p>De variabele naam van de database omgeving</p></li><li><p>Geeft als resultaat een object, <a href="https://docs.rs/mdbx/latest/src/mdbx/env.rs.html#27-35" target="_blank" rel="noopener noreferrer">mdbx:: env:: Config<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a>.</p></li></ol><p>We gebruiken de standaardconfiguratie, aangezien <code>Env</code> <code>From&lt;Into&lt;PathBuf&gt;&gt;</code> implementeert, dus het databasepad <code>into()</code> zal volstaan, en de standaardconfiguratie is als volgt.</p><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
<span class="token constant">MDBX</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
r<span class="token punctuation">,</span>
w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
<span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
<span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
<span class="token comment">// Geef het versienummer van libmdbx</span>
<span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span>
    <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
    mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Multi-threaded lezen en schrijven</span>
<span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
  test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

<span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
  path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
  mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
  flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
  sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
  sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
  max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
  pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
  <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
    <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
    sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// In 1/65536ste van een seconde</span>
    sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
    max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
    flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
        <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
      <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
      <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
      <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
      <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
      <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
      <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
    <span class="token punctuation">)</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>max_db</code> Deze instelling kan iedere keer dat de database <a href="https://github.com/erthink/libmdbx" target="_blank" rel="noopener noreferrer">wordt<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> geopend opnieuw worden ingesteld, maar een te hoge instelling zal de prestaties beïnvloeden, stel hem gewoon in zoals nodig.</p><p>Zie <a href="https://erthink.github.io/libmdbx/group__c__opening.html#ga9138119a904355d245777c4119534061" target="_blank" rel="noopener noreferrer">de libmdbx documentatie<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> voor de betekenis van de andere parameters.</p><ol start="3"><li><p>De naam van de database read transactie macro, de standaard waarde is <code>r</code></p></li><li><p>De naam van de database schrijf transactie macro, de standaard waarde is <code>w</code></p></li></ol><p>De parameters 3 en 4 kunnen worden weggelaten om de standaardwaarden te gebruiken.</p><h5 id="macro-uitbreiding" tabindex="-1"><a class="header-anchor" href="#macro-uitbreiding" aria-hidden="true">#</a> Macro uitbreiding</h5><p>Als je wilt zien wat de macro magie doet, kun je de <code>cargo expand --example 01</code> macro gebruiken om het uit te breiden, die eerst geïnstalleerd moet worden. <code>cargo install cargo-expand</code></p><p>Een screenshot van de uitgebreide code is hieronder te zien.</p><p><img src="//irmw.gumlet.io/PDzEtT.png" alt="PDzEtT"></p><h5 id="hoe-dan-ook-en-lazy-static" tabindex="-1"><a class="header-anchor" href="#hoe-dan-ook-en-lazy-static" aria-hidden="true">#</a> hoe dan ook en lazy_static</h5><p>In de uitgebreide schermafbeelding kunt u zien dat <code>lazy_static</code> en <code>anyhow</code>worden gebruikt.</p><p><a href="https://rustmagazine.github.io/rust_magazine_2021/chapter_2/rust_error_handle.html#thiserror--anyhow" target="_blank" rel="noopener noreferrer">hoe dan ook<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> is de foutafhandeling bibliotheek voor roest.</p><p><a href="https://juejin.cn/post/7007336922817232927" target="_blank" rel="noopener noreferrer">lazy_static<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> is een statische variabele met vertraagde initialisatie.</p><p>Deze twee bibliotheken zijn heel gewoon en ik zal er niet op ingaan.</p><h5 id="de-macro-mdbx" tabindex="-1"><a class="header-anchor" href="#de-macro-mdbx" aria-hidden="true">#</a> De macro mdbx!</h5><p><a href="https://docs.rs/mdbx-proc/latest/src/mdbx_proc/lib.rs.html" target="_blank" rel="noopener noreferrer"><code>mdbx!</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> is een <a href="https://mp.weixin.qq.com/s/YT_HNFDCQ_IyocvBkRNJnA" target="_blank" rel="noopener noreferrer">procedure macro<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a>.</p><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Geef het versienummer van libmdbx</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Multi-threaded lezen en schrijven</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
    sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
      <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
      sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// In 1/65536ste van een seconde</span>
      sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
      max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
          <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
        <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
 <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
 <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>
</code></pre></div><p>De eerste regel is de variabele naam van de database omgeving</p><p>De tweede regel is de naam van de database</p><p>Er kan meer dan één database zijn, één regel voor elke</p><h5 id="draden-en-transacties" tabindex="-1"><a class="header-anchor" href="#draden-en-transacties" aria-hidden="true">#</a> Draden en transacties</h5><p>De bovenstaande code demonstreert multi-threaded lezen en schrijven.</p><p>Het is belangrijk op te merken dat er <strong>slechts één transactie tegelijk in dezelfde thread kan zijn; als een thread meer dan één transactie open heeft staan, zal het programma crashen</strong>.</p><p>De transactie zal worden vastgelegd aan het einde van het toepassingsgebied.</p><h5 id="binaire-gegevens-lezen-en-schrijven" tabindex="-1"><a class="header-anchor" href="#binaire-gegevens-lezen-en-schrijven" aria-hidden="true">#</a> Binaire gegevens lezen en schrijven</h5><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Geef het versienummer van libmdbx</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Multi-threaded lezen en schrijven</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
    sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
      <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
      sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// In 1/65536ste van een seconde</span>
      sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
      max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
          <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
        <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
 <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
 <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
 <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> t<span class="token punctuation">:</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>set</code> is een schrijven, <code>get</code> is een lezen, en elk object dat implementeert <a href="https://doc.rust-lang.org/std/convert/trait.AsRef.html" target="_blank" rel="noopener noreferrer"><code>AsRef&lt;[u8]&gt;</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> object naar de database kan worden geschreven.</p><p><code>get</code> Wat eruit komt is <code>Ok(Some(Bin([6])))</code>dat kan worden omgezet in <code>&amp;[u8]</code>.</p><h3 id="voorbeeld-2-datatypes-databaseflags-wissen-traverseren" tabindex="-1"><a class="header-anchor" href="#voorbeeld-2-datatypes-databaseflags-wissen-traverseren" aria-hidden="true">#</a> Voorbeeld 2: Datatypes, databaseflags, wissen, traverseren</h3><p>Laten we eens kijken naar het tweede <a href="https://github.com/rmw-lib/mdbx/blob/master/examples/02.rs" target="_blank" rel="noopener noreferrer">voorbeeld/02.rs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a>:</p><p>In dit voorbeeld wordt <code>env_rw!</code> weggelaten en worden het derde en vierde argument ( <code>r</code>, <code>w</code>) weggelaten.</p><h4 id="code-1" tabindex="-1"><a class="header-anchor" href="#code-1" aria-hidden="true">#</a> Code</h4><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Geef het versienummer van libmdbx</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Multi-threaded lezen en schrijven</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
    sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
      <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
      sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// In 1/65536ste van een seconde</span>
      sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
      max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
          <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
        <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
 <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
 <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
 <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> t<span class="token punctuation">:</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Namen van variabelen voor database NLV</span>
  <span class="token class-name">Test1</span>
  <span class="token class-name">Test2</span>
    key <span class="token class-name">Str</span>
    val <span class="token class-name">Str</span>
  <span class="token class-name">Test3</span>
    key <span class="token keyword">i32</span>
    val <span class="token keyword">u64</span>
  <span class="token class-name">Test4</span>
    key <span class="token keyword">u64</span>
    val <span class="token keyword">u16</span>
    flag <span class="token constant">DUPSORT</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Snel schrijven</span>
  <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Snel lezen</span>
  <span class="token keyword">match</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>get <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;\nu16::from_le_bytes({:?}) = {}&quot;</span><span class="token punctuation">,</span>
        r<span class="token punctuation">,</span>
        <span class="token keyword">u16</span><span class="token punctuation">::</span><span class="token function">from_le_bytes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Meerdere bewerkingen op meerdere databases in dezelfde transactie</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>

    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test2 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test3 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test3</span><span class="token punctuation">;</span>

    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test3 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test4 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test4</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test4 rev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">rev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">dup</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;dup(16) {:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// De transactie zal worden vastgelegd aan het einde van het toepassingsgebied</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="voer-de-uitvoer-uit-1" tabindex="-1"><a class="header-anchor" href="#voer-de-uitvoer-uit-1" aria-hidden="true">#</a> Voer de uitvoer uit</h4><div class="language-text ext-text"><pre class="language-text"><code>mdbx file path /Users/z/rmw/mdbx/target/debug/examples/02.mdb

u16::from_le_bytes(Bin([4, 5])) = 1284

-- loop test1
[2] = [3]
[2, 3] = [4, 5]
[8, 1] = [9]
[9] = [10, 12]
[97, 98, 99] = [48, 49, 50]
[114, 109, 119, 46, 108, 105, 110, 107] = [68, 111, 119, 110, 32, 119, 105, 116, 104, 32, 68, 97, 116, 97, 32, 72, 101, 103, 101, 109, 111, 110, 121]
[examples/02.rs:57] test1.del_val([8, 1], [3])? = false
[examples/02.rs:58] test1.get([8, 1])?.unwrap() = Bin(
    [
        9,
    ],
)
[examples/02.rs:59] test1.del_val([8, 1], [9])? = true
[examples/02.rs:60] test1.get([8, 1])? = None
[examples/02.rs:62] test1.del([9])? = true
[examples/02.rs:63] test1.get([9])? = None
[examples/02.rs:64] test1.del([9])? = false

-- loop test2
abc = 012
rmw.link = Down with Data Hegemony

-- loop test3
0 = 6
10 = 5
13 = 32
16 = 32
-15 = 6
-12 = 6
-10 = 6
[examples/02.rs:100] test4.del_val(0, 2)? = true
[examples/02.rs:101] test4.del_val(0, 2)? = false

-- loop test4 rev
16 = 3
16 = 2
16 = 1
13 = 32
10 = 5
10 = 0
0 = 6
dup(16) 1
dup(16) 2
dup(16) 3
</code></pre></div><h4 id="snel-lezen-en-schrijven" tabindex="-1"><a class="header-anchor" href="#snel-lezen-en-schrijven" aria-hidden="true">#</a> Snel lezen en schrijven</h4><p>Als we slechts een enkele regel gegevens willen lezen of schrijven, kunnen we de syntactische suiker van de macro gebruiken.</p><p>Lees gegevens</p><div class="language-text ext-text"><pre class="language-text"><code>r!(Test1.get [2, 3])
</code></pre></div><p>Gegevens schrijven</p><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Geef het versienummer van libmdbx</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Multi-threaded lezen en schrijven</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
    sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
      <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
      sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// In 1/65536ste van een seconde</span>
      sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
      max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
          <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
        <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
 <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
 <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
 <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> t<span class="token punctuation">:</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Namen van variabelen voor database NLV</span>
  <span class="token class-name">Test1</span>
  <span class="token class-name">Test2</span>
    key <span class="token class-name">Str</span>
    val <span class="token class-name">Str</span>
  <span class="token class-name">Test3</span>
    key <span class="token keyword">i32</span>
    val <span class="token keyword">u64</span>
  <span class="token class-name">Test4</span>
    key <span class="token keyword">u64</span>
    val <span class="token keyword">u16</span>
    flag <span class="token constant">DUPSORT</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Snel schrijven</span>
  <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Snel lezen</span>
  <span class="token keyword">match</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>get <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;\nu16::from_le_bytes({:?}) = {}&quot;</span><span class="token punctuation">,</span>
        r<span class="token punctuation">,</span>
        <span class="token keyword">u16</span><span class="token punctuation">::</span><span class="token function">from_le_bytes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Meerdere bewerkingen op meerdere databases in dezelfde transactie</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>

    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test2 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test3 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test3</span><span class="token punctuation">;</span>

    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test3 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test4 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test4</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test4 rev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">rev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">dup</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;dup(16) {:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// De transactie zal worden vastgelegd aan het einde van het toepassingsgebied</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>Alles in één regel, zoals geschreven in <a href="https://github.com/rmw-lib/mdbx/blob/master/examples/02.rs" target="_blank" rel="noopener noreferrer">examples/02.rs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a>.</p><h4 id="gegevenstypen" tabindex="-1"><a class="header-anchor" href="#gegevenstypen" aria-hidden="true">#</a> Gegevenstypen</h4><p>In voorbeelden/02 <a href="https://github.com/rmw-lib/mdbx/blob/master/examples/02.rs" target="_blank" rel="noopener noreferrer">.rs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a>, ziet de database definitie er als volgt uit :</p><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Geef het versienummer van libmdbx</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Multi-threaded lezen en schrijven</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
    sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
      <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
      sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// In 1/65536ste van een seconde</span>
      sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
      max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
          <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
        <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
 <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
 <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
 <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> t<span class="token punctuation">:</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Namen van variabelen voor database NLV</span>
  <span class="token class-name">Test1</span>
  <span class="token class-name">Test2</span>
    key <span class="token class-name">Str</span>
    val <span class="token class-name">Str</span>
  <span class="token class-name">Test3</span>
    key <span class="token keyword">i32</span>
    val <span class="token keyword">u64</span>
  <span class="token class-name">Test4</span>
    key <span class="token keyword">u64</span>
    val <span class="token keyword">u16</span>
    flag <span class="token constant">DUPSORT</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Snel schrijven</span>
  <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Snel lezen</span>
  <span class="token keyword">match</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>get <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;\nu16::from_le_bytes({:?}) = {}&quot;</span><span class="token punctuation">,</span>
        r<span class="token punctuation">,</span>
        <span class="token keyword">u16</span><span class="token punctuation">::</span><span class="token function">from_le_bytes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Meerdere bewerkingen op meerdere databases in dezelfde transactie</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>

    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test2 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test3 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test3</span><span class="token punctuation">;</span>

    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test3 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test4 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test4</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test4 rev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">rev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">dup</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;dup(16) {:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// De transactie zal worden vastgelegd aan het einde van het toepassingsgebied</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token class-name">Test2</span>
  key <span class="token class-name">Str</span>
  val <span class="token class-name">Str</span>
<span class="token class-name">Test3</span>
  key <span class="token keyword">i32</span>
  val <span class="token keyword">u64</span>
<span class="token class-name">Test4</span>
  key <span class="token keyword">u64</span>
  val <span class="token keyword">u16</span>
  flag <span class="token constant">DUPSORT</span>
</code></pre></div><p>waarbij <code>key</code> en <code>val</code> de gegevenstypes voor respectievelijk sleutels en waarden definiëren.</p><p>Als u probeert een gegevenstype te schrijven dat niet overeenkomt met het gedefinieerde type, zal een fout worden gemeld, zoals in de schermafbeelding hieronder:</p><p><img src="//irmw.gumlet.io/4rFTC6.png" alt=""></p><p>Het standaard gegevenstype is <a href="https://docs.rs/mdbx/latest/mdbx/type/struct.Bin.html" target="_blank" rel="noopener noreferrer"><code>Bin</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> kunnen alle gegevens die <code>AsRef&lt;[u8]&gt;</code> implementeren, worden geschreven.</p><p>Als de sleutel of waarde een <code>utf8</code> string is, kan het gegevenstype worden ingesteld op <a href="https://docs.rs/mdbx/latest/mdbx/type/struct.Str.html" target="_blank" rel="noopener noreferrer"><code>Str</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> .</p><p><a href="https://doc.rust-lang.org/std/ops/trait.Deref.html" target="_blank" rel="noopener noreferrer">Als je<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> <code>Str</code> <a href="https://doc.rust-lang.org/std/ops/trait.Deref.html" target="_blank" rel="noopener noreferrer">derefereert<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a>, krijg je een string terug, vergelijkbaar met <code>let k:&amp;str = &amp;k;</code>.</p><p>Bovendien implementeert <code>Str</code> ook <a href="https://doc.rust-lang.org/std/fmt/trait.Display.html" target="_blank" rel="noopener noreferrer"><code>std::fmt::Display</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> , <code>println!(&quot;{}&quot;,k)</code> zal een leesbare string uitvoeren.</p><h5 id="vooraf-ingestelde-gegevenstypen" tabindex="-1"><a class="header-anchor" href="#vooraf-ingestelde-gegevenstypen" aria-hidden="true">#</a> Vooraf ingestelde gegevenstypen</h5><p>Naast <code>Str</code> en <code>Bin</code> heeft de wrapper ook gegevensondersteuning voor <a href="https://docs.rs/mdbx/latest/src/mdbx/type.rs.html#48" target="_blank" rel="noopener noreferrer">usize, u128, u64, u32, u16, u8, isize, i128, i64, i32, i16, i8, f32, f64<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a>.</p><h4 id="databank-vlaggen" tabindex="-1"><a class="header-anchor" href="#databank-vlaggen" aria-hidden="true">#</a> Databank vlaggen</h4><p>U kunt de databaseflaggen zien die zijn toegevoegd aan de gegevens in <a href="https://github.com/rmw-lib/mdbx/blob/master/examples/02.rs" target="_blank" rel="noopener noreferrer">examples/02.rs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> op <code>Test4</code> <code>flag DUPSORT</code></p><p>De libmdbx database heeft een aantal vlaggen ( <a href="https://erthink.github.io/libmdbx/group__c__dbi.html#gafe3bddb297b3ab0d828a487c5726f76a" target="_blank" rel="noopener noreferrer"><code>MDBX_db_flags_t</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> ) die kunnen worden ingesteld.</p><ul><li>REVERSEKEY gebruikt omgekeerde string-vergelijking voor sleutels. (nuttig bij gebruik van kleine eindgecodeerde nummers als toetsen)</li><li>DUPSORT gebruikt gesorteerde duplicaten, d.w.z. staat meerdere waarden voor een sleutel toe.</li><li>INTEGERKEY Native byte geordende numerieke sleutel uint32_t of uint64_t. sleutels moeten dezelfde grootte hebben en moeten uitgelijnd zijn wanneer ze als argumenten worden doorgegeven.</li><li>DUPFIXED De grootte van de gegevenswaarden moet gelijk zijn als DUPSORT wordt gebruikt (maakt een snelle telling van het aantal waarden mogelijk).</li><li>DUPSORT en DUPFIXED zijn vereist voor INTEGERDUP; de waarden zijn gehele getallen (vergelijkbaar met INTEGERKEY). De gegevenswaarden moeten allemaal dezelfde grootte hebben en moeten worden uitgelijnd wanneer ze als parameter worden doorgegeven.</li><li>REVERSEDUP gebruikt DUPSORT; omgekeerde stringvergelijking wordt gebruikt voor gegevenswaarden.</li><li>CREATE creëert de DB als die niet bestaat (standaard toegevoegd).</li><li>DB_ACCEDE Opent een bestaande subdatabase die is aangemaakt met de vlag onbekend.<br> Deze vlag DB_ACCEDE is bedoeld om bestaande subdatabanken te openen die zijn aangemaakt met onbekende vlaggen (REVERSEKEY, DUPSORT, INTEGERKEY, DUPFIXED, INTEGERDUP en REVERSEDUP).<br> In dit geval zal de subdatabase geen INCOMPATIBLE-fout teruggeven, maar zal ze geopend worden met de vlaggen die gebruikt werden om ze aan te maken, en de toepassing kan dan de eigenlijke vlaggen bepalen met mdbx_dbi_flags().</li></ul><h5 id="dupsort-een-sleutel-komt-overeen-met-meer-dan-een-waarde" tabindex="-1"><a class="header-anchor" href="#dupsort-een-sleutel-komt-overeen-met-meer-dan-een-waarde" aria-hidden="true">#</a> DUPSORT : Een sleutel komt overeen met meer dan een waarde</h5><p><code>DUPSORT</code>betekent dat een sleutel met meer dan één waarde kan corresponderen.</p><p>Als u meerdere vlaggen wilt instellen, schrijft u als volgt <code>flag DUPSORT | DUPFIXED</code></p><h5 id="dup-key-iterator-die-alle-waarden-teruggeeft-die-corresponderen-met-een-sleutel" tabindex="-1"><a class="header-anchor" href="#dup-key-iterator-die-alle-waarden-teruggeeft-die-corresponderen-met-een-sleutel" aria-hidden="true">#</a> <code>.dup(key)</code> iterator die alle waarden teruggeeft die corresponderen met een sleutel</h5><p>Deze functie is alleen beschikbaar voor databases gemarkeerd met <code>DUPSORT</code> waar een sleutel kan corresponderen met meer dan één waarde.</p><p>Voor <code>DUPSORT</code> databases, <code>get</code> geeft alleen de eerste waarde voor deze sleutel. Om alle waarden te krijgen, gebruik <code>dup</code>.</p><h5 id="standaard-automatisch-toegevoegde-databankvlaggen" tabindex="-1"><a class="header-anchor" href="#standaard-automatisch-toegevoegde-databankvlaggen" aria-hidden="true">#</a> Standaard automatisch toegevoegde databankvlaggen</h5><p>Wanneer het gegevenstype <code>u32</code> / <code>u64</code> / <code>usize</code> is, wordt de databaseflag automatisch toegevoegd <a href="https://docs.rs/mdbx-proc/latest/src/mdbx_proc/lib.rs.html#105" target="_blank" rel="noopener noreferrer"><code>INTEGERKEY</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> .</p><p>Op machines met small-end codering worden andere numerieke types automatisch toegevoegd <a href="https://docs.rs/mdbx-proc/latest/src/mdbx_proc/lib.rs.html#108" target="_blank" rel="noopener noreferrer"><code>REVERSEKEY</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> De databaseflag wordt automatisch toegevoegd wanneer het gegevenstype / / is.</p><h4 id="gegevens-verwijderen" tabindex="-1"><a class="header-anchor" href="#gegevens-verwijderen" aria-hidden="true">#</a> Gegevens verwijderen</h4><h5 id="del-key-een-toets-verwijderen" tabindex="-1"><a class="header-anchor" href="#del-key-een-toets-verwijderen" aria-hidden="true">#</a> <code>.del(key)</code> Een toets verwijderen</h5><p><code>.del(val)</code> Verwijdert de waarde die overeenkomt met een sleutel.</p><p>Als de database de vlag <code>DUPSORT</code>heeft, zullen alle waarden onder deze sleutel worden verwijderd.</p><p>Geeft <code>true</code>terug als gegevens zijn verwijderd, en <code>false</code>als dat niet het geval is.</p><h5 id="del-val-key-val-exacte-overeenkomst-wissen" tabindex="-1"><a class="header-anchor" href="#del-val-key-val-exacte-overeenkomst-wissen" aria-hidden="true">#</a> <code>.del_val(key,val)</code> Exacte overeenkomst wissen</h5><p><code>.del_val(key,val)</code> Verwijdert sleutel-waardeparen die precies overeenkomen met de invoerparameters.</p><p>Geeft <code>true</code>terug als gegevens zijn verwijderd, en <code>false</code>als dat niet het geval is.</p><h4 id="traversal" tabindex="-1"><a class="header-anchor" href="#traversal" aria-hidden="true">#</a> Traversal</h4><h5 id="sequentiele-traversal" tabindex="-1"><a class="header-anchor" href="#sequentiele-traversal" aria-hidden="true">#</a> sequentiële traversal</h5><p>Vanwege de uitvoering van <a href="https://doc.rust-lang.org/std/iter/trait.IntoIterator.html" target="_blank" rel="noopener noreferrer"><code>std::iter::IntoIterator</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> . kunt u rechtstreeks als volgt oversteken :</p><p><code>for (k, v) in test1</code></p><h5 id="rev-omgekeerde-volgorde-traversal" tabindex="-1"><a class="header-anchor" href="#rev-omgekeerde-volgorde-traversal" aria-hidden="true">#</a> <code>.rev()</code> Omgekeerde volgorde traversal</h5><p><code>for (k, v) in test4.rev()</code></p><h5 id="sorteren" tabindex="-1"><a class="header-anchor" href="#sorteren" aria-hidden="true">#</a> Sorteren</h5><p>De libmdbx-sleutels zijn gesorteerd in <a href="https://zh.wikipedia.org/wiki/%E5%AD%97%E5%85%B8%E5%BA%8F" target="_blank" rel="noopener noreferrer">dictionary-volgorde<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a>.</p><ul><li><p>Voor niet-ondertekende getallen</p><p>worden gesorteerd van klein naar groot omdat de databankvlaggen automatisch worden toegevoegd ( <code>u32</code>/ <code>u64</code>/ <code>usize</code> worden toegevoegd aan <code>INTEGERKEY</code>, andere worden toegevoegd aan <code>REVERSEKEY</code> afhankelijk van de machinecode).</p></li><li><p>Voor getekende getallen</p><p>de volgorde is: eerst 0, dan alle positieve getallen van klein naar groot, dan alle negatieve getallen van klein naar groot.</p></li></ul><h3 id="interval-iteratoren" tabindex="-1"><a class="header-anchor" href="#interval-iteratoren" aria-hidden="true">#</a> Interval iteratoren</h3><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Geef het versienummer van libmdbx</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Multi-threaded lezen en schrijven</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
    sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
      <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
      sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// In 1/65536ste van een seconde</span>
      sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
      max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
          <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
        <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
 <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
 <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
 <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> t<span class="token punctuation">:</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Namen van variabelen voor database NLV</span>
  <span class="token class-name">Test1</span>
  <span class="token class-name">Test2</span>
    key <span class="token class-name">Str</span>
    val <span class="token class-name">Str</span>
  <span class="token class-name">Test3</span>
    key <span class="token keyword">i32</span>
    val <span class="token keyword">u64</span>
  <span class="token class-name">Test4</span>
    key <span class="token keyword">u64</span>
    val <span class="token keyword">u16</span>
    flag <span class="token constant">DUPSORT</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Snel schrijven</span>
  <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Snel lezen</span>
  <span class="token keyword">match</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>get <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;\nu16::from_le_bytes({:?}) = {}&quot;</span><span class="token punctuation">,</span>
        r<span class="token punctuation">,</span>
        <span class="token keyword">u16</span><span class="token punctuation">::</span><span class="token function">from_le_bytes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Meerdere bewerkingen op meerdere databases in dezelfde transactie</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>

    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test2 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test3 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test3</span><span class="token punctuation">;</span>

    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test3 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test4 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test4</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test4 rev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">rev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">dup</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;dup(16) {:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// De transactie zal worden vastgelegd aan het einde van het toepassingsgebied</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token class-name">Test2</span>
  key <span class="token class-name">Str</span>
  val <span class="token class-name">Str</span>
<span class="token class-name">Test3</span>
  key <span class="token keyword">i32</span>
  val <span class="token keyword">u64</span>
<span class="token class-name">Test4</span>
  key <span class="token keyword">u64</span>
  val <span class="token keyword">u16</span>
  flag <span class="token constant">DUPSORT</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span>
  <span class="token class-name">Test0</span>
  <span class="token class-name">Test1</span>
    key <span class="token keyword">u16</span>
    val <span class="token keyword">u64</span>
    flag <span class="token constant">DUPSORT</span>
  <span class="token class-name">Test2</span>
    key <span class="token keyword">u32</span>
    val <span class="token keyword">u64</span>
<span class="token punctuation">}</span>

<span class="token macro property">macro_rules!</span> range_rev <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ident</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n# {}.rev_range({:?})&quot;</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$var</span><span class="token punctuation">.</span><span class="token function">range_rev</span><span class="token punctuation">(</span><span class="token variable">$range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property">macro_rules!</span> range <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ident</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n# {}.range({:?})&quot;</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$var</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token variable">$range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n&gt; Test0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test0 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test0</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">range!</span><span class="token punctuation">(</span>test0<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> begin<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test0<span class="token punctuation">,</span> begin<span class="token punctuation">..=</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;-- all&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n&gt; Test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="voer-de-uitvoer-van" tabindex="-1"><a class="header-anchor" href="#voer-de-uitvoer-van" aria-hidden="true">#</a> Voer de uitvoer van</h4><div class="language-text ext-text"><pre class="language-text"><code>mdbx file path /Users/z/rmw/mdbx/target/debug/examples/range.mdb

&gt; Test0

# test0.range([1]..)
(Bin([1]), Bin([1, 2]))
(Bin([1, 1]), Bin([1, 3]))
(Bin([1, 2]), Bin([1, 3]))
(Bin([2]), Bin([2, 3]))
(Bin([3]), Bin([]))

# test0.range([1, 1]..=[2])
(Bin([1, 1]), Bin([1, 3]))
(Bin([1, 2]), Bin([1, 3]))
(Bin([2]), Bin([2, 3]))
-- all
(2, 4)
(2, 9)
(3, 0)
(3, 8)
(5, 3)
(5, 8)
(9, 1)
(9, 2)
(9, 7)

# test1.range(1..3)
(2, 4)
(2, 9)

# test1.range(5..2)
(5, 8)
(5, 3)
(3, 8)
(3, 0)

# test1.range(1..=3)
(2, 4)
(2, 9)
(3, 0)
(3, 8)

# test1.range(..3)
(2, 4)
(2, 9)

# test1.range(3..)
(3, 0)
(3, 8)
(5, 3)
(5, 8)
(9, 1)
(9, 2)
(9, 7)

# test1.rev_range(..1)
(9, 7)
(9, 2)
(9, 1)
(5, 8)
(5, 3)
(3, 8)
(3, 0)
(2, 9)
(2, 4)

# test1.rev_range(..=1)
(9, 7)
(9, 2)
(9, 1)
(5, 8)
(5, 3)
(3, 8)
(3, 0)
(2, 9)
(2, 4)

&gt; Test2

# test2.range(1..3)
(1, 5)
(2, 4)

# test2.range(1..=3)
(1, 5)
(2, 4)

# test2.range(..3)
(0, 0)
(1, 5)
(2, 4)

# test2.range(2..)
(2, 4)
(9, 1)

# test2.rev_range(..1)
(9, 1)
(2, 4)

# test2.rev_range(2..)
(2, 4)
(1, 5)
(0, 0)

# test2.rev_range(..=1)
(9, 1)
(2, 4)
(1, 5)
</code></pre></div><h4 id="range-begin-end-interval-iteratie" tabindex="-1"><a class="header-anchor" href="#range-begin-end-interval-iteratie" aria-hidden="true">#</a> <code>.range(begin..end)</code> Interval Iteratie</h4><p>Voor getallen is een interval een numeriek interval.</p><p>Voor binair kan hetzelfde interval worden geconstrueerd, bv.</p><div class="language-text ext-text"><pre class="language-text"><code>let begin : &amp;[u8] = &amp;[1,1];
for (k,v) in test0.range(begin..=&amp;[2]) {}
</code></pre></div><p>Als <code>begin</code> groter is dan <code>end</code>, zal het terugwaarts gaan.</p><p>Bijvoorbeeld, <code>test1.range(5..2)</code> zal het volgende uitvoeren :</p><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Geef het versienummer van libmdbx</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Multi-threaded lezen en schrijven</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
    sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
      <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
      sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// In 1/65536ste van een seconde</span>
      sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
      max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
          <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
        <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
 <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
 <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
 <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> t<span class="token punctuation">:</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Namen van variabelen voor database NLV</span>
  <span class="token class-name">Test1</span>
  <span class="token class-name">Test2</span>
    key <span class="token class-name">Str</span>
    val <span class="token class-name">Str</span>
  <span class="token class-name">Test3</span>
    key <span class="token keyword">i32</span>
    val <span class="token keyword">u64</span>
  <span class="token class-name">Test4</span>
    key <span class="token keyword">u64</span>
    val <span class="token keyword">u16</span>
    flag <span class="token constant">DUPSORT</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Snel schrijven</span>
  <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Snel lezen</span>
  <span class="token keyword">match</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>get <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;\nu16::from_le_bytes({:?}) = {}&quot;</span><span class="token punctuation">,</span>
        r<span class="token punctuation">,</span>
        <span class="token keyword">u16</span><span class="token punctuation">::</span><span class="token function">from_le_bytes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Meerdere bewerkingen op meerdere databases in dezelfde transactie</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>

    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test2 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test3 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test3</span><span class="token punctuation">;</span>

    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test3 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test4 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test4</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test4 rev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">rev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">dup</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;dup(16) {:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// De transactie zal worden vastgelegd aan het einde van het toepassingsgebied</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token class-name">Test2</span>
  key <span class="token class-name">Str</span>
  val <span class="token class-name">Str</span>
<span class="token class-name">Test3</span>
  key <span class="token keyword">i32</span>
  val <span class="token keyword">u64</span>
<span class="token class-name">Test4</span>
  key <span class="token keyword">u64</span>
  val <span class="token keyword">u16</span>
  flag <span class="token constant">DUPSORT</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span>
  <span class="token class-name">Test0</span>
  <span class="token class-name">Test1</span>
    key <span class="token keyword">u16</span>
    val <span class="token keyword">u64</span>
    flag <span class="token constant">DUPSORT</span>
  <span class="token class-name">Test2</span>
    key <span class="token keyword">u32</span>
    val <span class="token keyword">u64</span>
<span class="token punctuation">}</span>

<span class="token macro property">macro_rules!</span> range_rev <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ident</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n# {}.rev_range({:?})&quot;</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$var</span><span class="token punctuation">.</span><span class="token function">range_rev</span><span class="token punctuation">(</span><span class="token variable">$range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property">macro_rules!</span> range <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ident</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n# {}.range({:?})&quot;</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$var</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token variable">$range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n&gt; Test0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test0 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test0</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">range!</span><span class="token punctuation">(</span>test0<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> begin<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test0<span class="token punctuation">,</span> begin<span class="token punctuation">..=</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;-- all&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n&gt; Test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre></div><p>Interval iteratie wordt niet ondersteund <a href="https://doc.rust-lang.org/std/ops/struct.RangeFull.html" target="_blank" rel="noopener noreferrer"><code>RangeFull</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> <code>..</code> wordt niet ondersteund, gebruik in plaats daarvan de hierboven genoemde <a href="#%E9%81%8D%E5%8E%86">traversal</a>.</p><h4 id="rev-range-omgekeerde-intervallen" tabindex="-1"><a class="header-anchor" href="#rev-range-omgekeerde-intervallen" aria-hidden="true">#</a> <code>.rev_range</code> Omgekeerde intervallen</h4><p>Indien je een geïnverteerd interval wil bekomen dat kleiner of gelijk is aan een waarde, kan je dit doen</p><div class="language-text ext-text"><pre class="language-text"><code>test2.rev_range(2..)
</code></pre></div><p>Zet de uitgang</p><div class="language-text ext-text"><pre class="language-text"><code>(2, 4)
(1, 5)
(0, 0)
</code></pre></div><p>Eén van <code>begin</code> of <code>end</code> mag niet zijn ingesteld voor het omgekeerde interval; want als beide zijn ingesteld, kunt u altijd <code>range(end..begin)</code> gebruiken om hetzelfde effect te bereiken.</p><h3 id="aanpassen-van-gegevenstypen" tabindex="-1"><a class="header-anchor" href="#aanpassen-van-gegevenstypen" aria-hidden="true">#</a> Aanpassen van gegevenstypen</h3><p>De demo code is beschikbaar op <a href="https://github.com/rmw-lib/mdbx-example/blob/master/01/src/main.rs" target="_blank" rel="noopener noreferrer">github.com/rmw-lib/mdbx-example/01<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a></p><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Geef het versienummer van libmdbx</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Multi-threaded lezen en schrijven</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
    sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
      <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
      sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// In 1/65536ste van een seconde</span>
      sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
      max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
          <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
        <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
 <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
 <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
 <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> t<span class="token punctuation">:</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Namen van variabelen voor database NLV</span>
  <span class="token class-name">Test1</span>
  <span class="token class-name">Test2</span>
    key <span class="token class-name">Str</span>
    val <span class="token class-name">Str</span>
  <span class="token class-name">Test3</span>
    key <span class="token keyword">i32</span>
    val <span class="token keyword">u64</span>
  <span class="token class-name">Test4</span>
    key <span class="token keyword">u64</span>
    val <span class="token keyword">u16</span>
    flag <span class="token constant">DUPSORT</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Snel schrijven</span>
  <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Snel lezen</span>
  <span class="token keyword">match</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>get <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;\nu16::from_le_bytes({:?}) = {}&quot;</span><span class="token punctuation">,</span>
        r<span class="token punctuation">,</span>
        <span class="token keyword">u16</span><span class="token punctuation">::</span><span class="token function">from_le_bytes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Meerdere bewerkingen op meerdere databases in dezelfde transactie</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>

    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test2 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test3 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test3</span><span class="token punctuation">;</span>

    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test3 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test4 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test4</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test4 rev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">rev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">dup</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;dup(16) {:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// De transactie zal worden vastgelegd aan het einde van het toepassingsgebied</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token class-name">Test2</span>
  key <span class="token class-name">Str</span>
  val <span class="token class-name">Str</span>
<span class="token class-name">Test3</span>
  key <span class="token keyword">i32</span>
  val <span class="token keyword">u64</span>
<span class="token class-name">Test4</span>
  key <span class="token keyword">u64</span>
  val <span class="token keyword">u16</span>
  flag <span class="token constant">DUPSORT</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span>
  <span class="token class-name">Test0</span>
  <span class="token class-name">Test1</span>
    key <span class="token keyword">u16</span>
    val <span class="token keyword">u64</span>
    flag <span class="token constant">DUPSORT</span>
  <span class="token class-name">Test2</span>
    key <span class="token keyword">u32</span>
    val <span class="token keyword">u64</span>
<span class="token punctuation">}</span>

<span class="token macro property">macro_rules!</span> range_rev <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ident</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n# {}.rev_range({:?})&quot;</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$var</span><span class="token punctuation">.</span><span class="token function">range_rev</span><span class="token punctuation">(</span><span class="token variable">$range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property">macro_rules!</span> range <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ident</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n# {}.range({:?})&quot;</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$var</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token variable">$range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n&gt; Test0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test0 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test0</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">range!</span><span class="token punctuation">(</span>test0<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> begin<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test0<span class="token punctuation">,</span> begin<span class="token punctuation">..=</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;-- all&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n&gt; Test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">speedy<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Readable</span><span class="token punctuation">,</span> <span class="token class-name">Writable</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(PartialEq, Debug, Readable, Writable)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">City</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
  lnglat<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">FromMdbx</span> <span class="token keyword">for</span> <span class="token class-name">City</span> <span class="token punctuation">{</span>
  <span class="token keyword">fn</span> <span class="token function-definition function">from_mdbx</span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> <span class="token class-name">PtrTx</span><span class="token punctuation">,</span> val<span class="token punctuation">:</span> <span class="token class-name">MDBX_val</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
    <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">read_from_buffer</span><span class="token punctuation">(</span><span class="token macro property">val_bytes!</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">ToAsRef</span><span class="token operator">&lt;</span><span class="token class-name">City</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;&gt;</span> <span class="token keyword">for</span> <span class="token class-name">City</span> <span class="token punctuation">{</span>
  <span class="token keyword">fn</span> <span class="token function-definition function">to_as_ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">write_to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span>
  <span class="token class-name">Test</span>
    key <span class="token keyword">u16</span>
    val <span class="token class-name">City</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> city <span class="token operator">=</span> <span class="token class-name">City</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;BeiJing&quot;</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    lnglat<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">11640</span><span class="token punctuation">,</span> <span class="token number">3990</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
  test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> city<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>De output is als volgt</p><div class="language-text ext-text"><pre class="language-text"><code>Some(City { name: &quot;BeiJing&quot;, lnglat: (11640, 3990) })
</code></pre></div><p>In het aangepaste type voorbeeld, gebruiken we <a href="https://github.com/koute/speedy" target="_blank" rel="noopener noreferrer"><code>speedy</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> om de serialisatie te doen <a href="https://github.com/djkoloski/rust_serialization_benchmark" target="_blank" rel="noopener noreferrer">( <code>speedy</code> performance review<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> ).</p><p>De aangepaste type-implementatie <a href="https://docs.rs/mdbx/latest/mdbx/type/trait.FromMdbx.html" target="_blank" rel="noopener noreferrer"><code>FromMdbx</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> en <a href="https://docs.rs/mdbx/latest/mdbx/type/trait.ToAsRef.html" target="_blank" rel="noopener noreferrer"><code>ToAsRef</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> kan dan worden opgeslagen op <code>mdbx</code>.</p><p>Als u een specifieke serialisatiebibliotheek gebruikt, kunt u ook attribuutmacro <a href="https://blog.logrocket.com/macros-in-rust-a-tutorial-with-examples/" target="_blank" rel="noopener noreferrer">&#39;s<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> aanpassen om het proces te vereenvoudigen.</p><h4 id="aangepaste-types-vereenvoudigen-met-attribuutmacro-s" tabindex="-1"><a class="header-anchor" href="#aangepaste-types-vereenvoudigen-met-attribuutmacro-s" aria-hidden="true">#</a> Aangepaste types vereenvoudigen met attribuutmacro&#39;s</h4><p>Het implementeren van een attribuut macro is zo simpel als <a href="https://crates.io/crates/mdbx_speedy" target="_blank" rel="noopener noreferrer"><code>mdbx_speedy</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> De attribuut-macrocode is als volgt :</p><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Geef het versienummer van libmdbx</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Multi-threaded lezen en schrijven</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
    sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
      <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
      sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// In 1/65536ste van een seconde</span>
      sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
      max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
          <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
        <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
 <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
 <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
 <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> t<span class="token punctuation">:</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Namen van variabelen voor database NLV</span>
  <span class="token class-name">Test1</span>
  <span class="token class-name">Test2</span>
    key <span class="token class-name">Str</span>
    val <span class="token class-name">Str</span>
  <span class="token class-name">Test3</span>
    key <span class="token keyword">i32</span>
    val <span class="token keyword">u64</span>
  <span class="token class-name">Test4</span>
    key <span class="token keyword">u64</span>
    val <span class="token keyword">u16</span>
    flag <span class="token constant">DUPSORT</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Snel schrijven</span>
  <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Snel lezen</span>
  <span class="token keyword">match</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>get <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;\nu16::from_le_bytes({:?}) = {}&quot;</span><span class="token punctuation">,</span>
        r<span class="token punctuation">,</span>
        <span class="token keyword">u16</span><span class="token punctuation">::</span><span class="token function">from_le_bytes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Meerdere bewerkingen op meerdere databases in dezelfde transactie</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>

    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test2 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test3 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test3</span><span class="token punctuation">;</span>

    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test3 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test4 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test4</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test4 rev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">rev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">dup</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;dup(16) {:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// De transactie zal worden vastgelegd aan het einde van het toepassingsgebied</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token class-name">Test2</span>
  key <span class="token class-name">Str</span>
  val <span class="token class-name">Str</span>
<span class="token class-name">Test3</span>
  key <span class="token keyword">i32</span>
  val <span class="token keyword">u64</span>
<span class="token class-name">Test4</span>
  key <span class="token keyword">u64</span>
  val <span class="token keyword">u16</span>
  flag <span class="token constant">DUPSORT</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span>
  <span class="token class-name">Test0</span>
  <span class="token class-name">Test1</span>
    key <span class="token keyword">u16</span>
    val <span class="token keyword">u64</span>
    flag <span class="token constant">DUPSORT</span>
  <span class="token class-name">Test2</span>
    key <span class="token keyword">u32</span>
    val <span class="token keyword">u64</span>
<span class="token punctuation">}</span>

<span class="token macro property">macro_rules!</span> range_rev <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ident</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n# {}.rev_range({:?})&quot;</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$var</span><span class="token punctuation">.</span><span class="token function">range_rev</span><span class="token punctuation">(</span><span class="token variable">$range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property">macro_rules!</span> range <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ident</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n# {}.range({:?})&quot;</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$var</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token variable">$range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n&gt; Test0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test0 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test0</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">range!</span><span class="token punctuation">(</span>test0<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> begin<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test0<span class="token punctuation">,</span> begin<span class="token punctuation">..=</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;-- all&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n&gt; Test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">speedy<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Readable</span><span class="token punctuation">,</span> <span class="token class-name">Writable</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(PartialEq, Debug, Readable, Writable)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">City</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
  lnglat<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">FromMdbx</span> <span class="token keyword">for</span> <span class="token class-name">City</span> <span class="token punctuation">{</span>
  <span class="token keyword">fn</span> <span class="token function-definition function">from_mdbx</span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> <span class="token class-name">PtrTx</span><span class="token punctuation">,</span> val<span class="token punctuation">:</span> <span class="token class-name">MDBX_val</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
    <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">read_from_buffer</span><span class="token punctuation">(</span><span class="token macro property">val_bytes!</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">ToAsRef</span><span class="token operator">&lt;</span><span class="token class-name">City</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;&gt;</span> <span class="token keyword">for</span> <span class="token class-name">City</span> <span class="token punctuation">{</span>
  <span class="token keyword">fn</span> <span class="token function-definition function">to_as_ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">write_to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span>
  <span class="token class-name">Test</span>
    key <span class="token keyword">u16</span>
    val <span class="token class-name">City</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> city <span class="token operator">=</span> <span class="token class-name">City</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;BeiJing&quot;</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    lnglat<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">11640</span><span class="token punctuation">,</span> <span class="token number">3990</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
  test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> city<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">proc_macro</span><span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">syn</span><span class="token punctuation">;</span>
<span class="token attribute attr-name">#[macro_use]</span>
<span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">quote</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token namespace">proc_macro<span class="token punctuation">::</span></span><span class="token class-name">TokenStream</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[proc_macro_derive(MdbxSpeedy)]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">mdbx_speedy</span><span class="token punctuation">(</span>ts<span class="token punctuation">:</span> <span class="token class-name">TokenStream</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">TokenStream</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> ast<span class="token punctuation">:</span> <span class="token namespace">syn<span class="token punctuation">::</span></span><span class="token class-name">DeriveInput</span> <span class="token operator">=</span> <span class="token namespace">syn<span class="token punctuation">::</span></span><span class="token function">parse</span><span class="token punctuation">(</span>ts<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token operator">&amp;</span>ast<span class="token punctuation">.</span>ident<span class="token punctuation">;</span>
  <span class="token macro property">quote!</span> <span class="token punctuation">{</span>
    <span class="token keyword">impl</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token class-name">FromMdbx</span> <span class="token keyword">for</span> #name <span class="token punctuation">{</span>
      <span class="token keyword">fn</span> <span class="token function-definition function">from_mdbx</span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token class-name">PtrTx</span><span class="token punctuation">,</span> val<span class="token punctuation">:</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token class-name">MDBX_val</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">read_from_buffer</span><span class="token punctuation">(</span><span class="token macro property">val_bytes!</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">impl</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token class-name">ToAsRef</span><span class="token operator">&lt;</span>#name<span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;&gt;</span> <span class="token keyword">for</span> #name <span class="token punctuation">{</span>
      <span class="token keyword">fn</span> <span class="token function-definition function">to_as_ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">write_to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
  <span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Begin met <code>cargo add mdbx-speedy</code>in je eigen project en dan kun je het type snel aanpassen (zie <a href="https://github.com/rmw-lib/mdbx-example/blob/master/02/src/main.rs" target="_blank" rel="noopener noreferrer">github.com/rmw-lib/mdbx-example/02<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> voor demo code).</p><div class="language-rust ext-rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">db<span class="token punctuation">::</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> id <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span>get id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span>
  <span class="token constant">MDBX</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  r<span class="token punctuation">,</span>
  w
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
  <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Geef het versienummer van libmdbx</span>
  <span class="token keyword">unsafe</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span>
      <span class="token string">&quot;mdbx version https://github.com/erthink/libmdbx/releases/tag/v{}.{}.{}&quot;</span><span class="token punctuation">,</span>
      mdbx_version<span class="token punctuation">.</span>major<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>minor<span class="token punctuation">,</span> mdbx_version<span class="token punctuation">.</span>release
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Multi-threaded lezen en schrijven</span>
  <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>thread<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span><span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
      <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  t<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
  <span class="token attribute attr-name">#[derive(Clone, Debug)]</span>
  <span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Config</span> <span class="token punctuation">{</span>
    path<span class="token punctuation">:</span> <span class="token class-name">PathBuf</span><span class="token punctuation">,</span>
    mode<span class="token punctuation">:</span> <span class="token namespace">ffi<span class="token punctuation">::</span></span>mdbx_mode_t<span class="token punctuation">,</span>
    flag<span class="token punctuation">:</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">,</span>
    sync_period<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    sync_bytes<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    max_db<span class="token punctuation">:</span> <span class="token keyword">u64</span><span class="token punctuation">,</span>
    pagesize<span class="token punctuation">:</span> <span class="token keyword">isize</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  
  <span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">ENV_CONFIG_DEFAULT</span><span class="token punctuation">:</span> <span class="token class-name">Config</span> <span class="token operator">=</span> <span class="token class-name">Config</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span><span class="token class-name">PathBuf</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mode<span class="token punctuation">:</span> <span class="token number">0o600</span><span class="token punctuation">,</span>
      <span class="token comment">//https://github.com/erthink/libmdbx/issues/248</span>
      sync_period <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span> <span class="token comment">// In 1/65536ste van een seconde</span>
      sync_bytes <span class="token punctuation">:</span> <span class="token number">65536</span><span class="token punctuation">,</span>
      max_db <span class="token punctuation">:</span> <span class="token number">256</span><span class="token punctuation">,</span>
      flag <span class="token punctuation">:</span> <span class="token punctuation">(</span>
          <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_EXCLUSIVE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_LIFORECLAIM</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_COALESCE</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOMEMINIT</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_NOSUBDIR</span>
        <span class="token operator">|</span> <span class="token namespace">flag<span class="token punctuation">::</span></span><span class="token constant">ENV</span><span class="token punctuation">::</span><span class="token constant">MDBX_SAFE_NOSYNC</span>
        <span class="token comment">// | flag::ENV::MDBX_SYNC_DURABLE</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
      pagesize<span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
 <span class="token constant">MDBX</span> <span class="token comment">// Variabele naam van de database Env</span>
 <span class="token class-name">Test</span> <span class="token comment">// Database Test</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;test1 get {:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">match</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span> <span class="token punctuation">{</span>
 <span class="token class-name">Some</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> t<span class="token punctuation">:</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>val<span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Ok</span><span class="token punctuation">,</span> <span class="token class-name">Result</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span> <span class="token comment">// Namen van variabelen voor database NLV</span>
  <span class="token class-name">Test1</span>
  <span class="token class-name">Test2</span>
    key <span class="token class-name">Str</span>
    val <span class="token class-name">Str</span>
  <span class="token class-name">Test3</span>
    key <span class="token keyword">i32</span>
    val <span class="token keyword">u64</span>
  <span class="token class-name">Test4</span>
    key <span class="token keyword">u64</span>
    val <span class="token keyword">u16</span>
    flag <span class="token constant">DUPSORT</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// Snel schrijven</span>
  <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Snel lezen</span>
  <span class="token keyword">match</span> <span class="token macro property">r!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>get <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Some</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span>
        <span class="token string">&quot;\nu16::from_le_bytes({:?}) = {}&quot;</span><span class="token punctuation">,</span>
        r<span class="token punctuation">,</span>
        <span class="token keyword">u16</span><span class="token punctuation">::</span><span class="token function">from_le_bytes</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">try_into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token macro property">unreachable!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// Meerdere bewerkingen op meerdere databases in dezelfde transactie</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>

    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test1<span class="token punctuation">.</span><span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;rmw.link&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Down with Data Hegemony&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token string">&quot;012&quot;</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test2 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{} = {}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test3 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test3</span><span class="token punctuation">;</span>

    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test3<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test3 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> test4 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test4</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test4<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">dbg!</span><span class="token punctuation">(</span>test4<span class="token punctuation">.</span><span class="token function">del_val</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n-- loop test4 rev&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">rev</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?} = {:?}&quot;</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> test4<span class="token punctuation">.</span><span class="token function">dup</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;dup(16) {:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// De transactie zal worden vastgelegd aan het einde van het toepassingsgebied</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token class-name">Test1</span><span class="token punctuation">.</span>set <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token class-name">Test2</span>
  key <span class="token class-name">Str</span>
  val <span class="token class-name">Str</span>
<span class="token class-name">Test3</span>
  key <span class="token keyword">i32</span>
  val <span class="token keyword">u64</span>
<span class="token class-name">Test4</span>
  key <span class="token keyword">u64</span>
  val <span class="token keyword">u16</span>
  flag <span class="token constant">DUPSORT</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;mdbx file path {}&quot;</span><span class="token punctuation">,</span> db_path<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span>
  <span class="token class-name">Test0</span>
  <span class="token class-name">Test1</span>
    key <span class="token keyword">u16</span>
    val <span class="token keyword">u64</span>
    flag <span class="token constant">DUPSORT</span>
  <span class="token class-name">Test2</span>
    key <span class="token keyword">u32</span>
    val <span class="token keyword">u64</span>
<span class="token punctuation">}</span>

<span class="token macro property">macro_rules!</span> range_rev <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ident</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n# {}.rev_range({:?})&quot;</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$var</span><span class="token punctuation">.</span><span class="token function">range_rev</span><span class="token punctuation">(</span><span class="token variable">$range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property">macro_rules!</span> range <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">ident</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">:</span><span class="token fragment-specifier punctuation">expr</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n# {}.range({:?})&quot;</span><span class="token punctuation">,</span> <span class="token macro property">stringify!</span><span class="token punctuation">(</span><span class="token variable">$var</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$range</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable">$var</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token variable">$range</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n&gt; Test0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test0 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test0</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">range!</span><span class="token punctuation">(</span>test0<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> begin<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token keyword">u8</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test0<span class="token punctuation">,</span> begin<span class="token punctuation">..=</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> test1 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test1</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;-- all&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> test1 <span class="token punctuation">{</span>
      <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test1<span class="token punctuation">,</span> <span class="token punctuation">..=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;\n&gt; Test2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token constant">MDBX</span><span class="token punctuation">.</span><span class="token function">w</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> test2 <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test2</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
    test2<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>

    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">..=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">range_rev!</span><span class="token punctuation">(</span>test2<span class="token punctuation">,</span> <span class="token punctuation">..=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">speedy<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Readable</span><span class="token punctuation">,</span> <span class="token class-name">Writable</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(PartialEq, Debug, Readable, Writable)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">City</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
  lnglat<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">FromMdbx</span> <span class="token keyword">for</span> <span class="token class-name">City</span> <span class="token punctuation">{</span>
  <span class="token keyword">fn</span> <span class="token function-definition function">from_mdbx</span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> <span class="token class-name">PtrTx</span><span class="token punctuation">,</span> val<span class="token punctuation">:</span> <span class="token class-name">MDBX_val</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
    <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">read_from_buffer</span><span class="token punctuation">(</span><span class="token macro property">val_bytes!</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token class-name">ToAsRef</span><span class="token operator">&lt;</span><span class="token class-name">City</span><span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;&gt;</span> <span class="token keyword">for</span> <span class="token class-name">City</span> <span class="token punctuation">{</span>
  <span class="token keyword">fn</span> <span class="token function-definition function">to_as_ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">write_to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token macro property">env_rw!</span><span class="token punctuation">(</span><span class="token constant">MDBX</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token keyword">mut</span> db_path <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>env<span class="token punctuation">::</span></span><span class="token function">current_exe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">set_extension</span><span class="token punctuation">(</span><span class="token string">&quot;mdb&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  db_path<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">mdbx!</span> <span class="token punctuation">{</span>
  <span class="token constant">MDBX</span>
  <span class="token class-name">Test</span>
    key <span class="token keyword">u16</span>
    val <span class="token class-name">City</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> city <span class="token operator">=</span> <span class="token class-name">City</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;BeiJing&quot;</span><span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    lnglat<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">11640</span><span class="token punctuation">,</span> <span class="token number">3990</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> tx <span class="token operator">=</span> <span class="token macro property">w!</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> test <span class="token operator">=</span> tx <span class="token operator">|</span> <span class="token class-name">Test</span><span class="token punctuation">;</span>
  test<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> city<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
  <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> test<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">proc_macro</span><span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">syn</span><span class="token punctuation">;</span>
<span class="token attribute attr-name">#[macro_use]</span>
<span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">quote</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token namespace">proc_macro<span class="token punctuation">::</span></span><span class="token class-name">TokenStream</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[proc_macro_derive(MdbxSpeedy)]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">mdbx_speedy</span><span class="token punctuation">(</span>ts<span class="token punctuation">:</span> <span class="token class-name">TokenStream</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">TokenStream</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> ast<span class="token punctuation">:</span> <span class="token namespace">syn<span class="token punctuation">::</span></span><span class="token class-name">DeriveInput</span> <span class="token operator">=</span> <span class="token namespace">syn<span class="token punctuation">::</span></span><span class="token function">parse</span><span class="token punctuation">(</span>ts<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token operator">&amp;</span>ast<span class="token punctuation">.</span>ident<span class="token punctuation">;</span>
  <span class="token macro property">quote!</span> <span class="token punctuation">{</span>
    <span class="token keyword">impl</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token class-name">FromMdbx</span> <span class="token keyword">for</span> #name <span class="token punctuation">{</span>
      <span class="token keyword">fn</span> <span class="token function-definition function">from_mdbx</span><span class="token punctuation">(</span>_<span class="token punctuation">:</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token class-name">PtrTx</span><span class="token punctuation">,</span> val<span class="token punctuation">:</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token class-name">MDBX_val</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">Self</span><span class="token punctuation">::</span><span class="token function">read_from_buffer</span><span class="token punctuation">(</span><span class="token macro property">val_bytes!</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">impl</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token class-name">ToAsRef</span><span class="token operator">&lt;</span>#name<span class="token punctuation">,</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;&gt;</span> <span class="token keyword">for</span> #name <span class="token punctuation">{</span>
      <span class="token keyword">fn</span> <span class="token function-definition function">to_as_ref</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">write_to_vec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
  <span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">use</span> <span class="token namespace">anyhow<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">mdbx_speedy<span class="token punctuation">::</span></span><span class="token class-name">MdbxSpeedy</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">speedy<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Readable</span><span class="token punctuation">,</span> <span class="token class-name">Writable</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(PartialEq, Debug, Readable, Writable, MdbxSpeedy)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">City</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
  lnglat<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token keyword">u32</span><span class="token punctuation">,</span> <span class="token keyword">u32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Natuurlijk is het nog steeds vervelend om herhaaldelijk <code>#[derive(PartialEq, Debug, Readable, Writable, MdbxSpeedy)]</code> te schrijven, dus je kunt <a href="https://docs.rs/derive-alias/0.1.0/derive_alias" target="_blank" rel="noopener noreferrer"><code>derive_alias</code><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> om de code verder te vereenvoudigen.</p><h2 id="opmerking-over-het-gebruik-van" tabindex="-1"><a class="header-anchor" href="#opmerking-over-het-gebruik-van" aria-hidden="true">#</a> Opmerking over het gebruik van</h2><h3 id="de-lengte-van-de-sleutel" tabindex="-1"><a class="header-anchor" href="#de-lengte-van-de-sleutel" aria-hidden="true">#</a> De lengte van de sleutel</h3><ul><li>Minimum 0, maximum ≈ ½ paginagrootte (standaard 4K paginasleutel maximumgrootte is 2022 bytes), ingesteld bij het initialiseren van de databank <code>pagesize</code> kan worden ingesteld op niet meer dan <code>65536</code>en moet een macht van 2 zijn.</li></ul><h2 id="voetnoten" tabindex="-1"><a class="header-anchor" href="#voetnoten" aria-hidden="true">#</a> Voetnoten</h2><p>Zij noemen de voordelen van de overschakeling van LMDB op MDBX.</p><blockquote><p>Erigon begon met een BoltDB database backend, voegde vervolgens ondersteuning voor BadgerDB toe, en migreerde uiteindelijk volledig naar LMDB. op een gegeven moment liepen we tegen stabiliteitsproblemen aan die werden veroorzaakt door ons gebruik van LMDB die niet waren voorzien door de makers. Sindsdien hebben wij gekeken naar een goed ondersteunde afgeleide van LMDB genaamd MDBX en hopen wij gebruik te maken van hun stabiliteitsverbeteringen en mogelijk meer samen te werken in de toekomst. De integratie van MDBX is nu voltooid en het is tijd voor meer testen en documentatie.</p><p>Voordelen van de overschakeling van LMDB naar MDBX.</p><ol><li><p>De groei &quot;ruimte (geometrie)&quot; van de databasebestanden werkt naar behoren. Dit is belangrijk, vooral op Windows. In LMDB moet men de grootte van de geheugenmap eenmalig vooraf opgeven (momenteel gebruiken wij standaard 2Tb) en als het databasebestand boven deze limiet groeit, moet het proces opnieuw worden opgestart. Op Windows zou het instellen van de geheugenkaart grootte op 2Tb het database bestand 2Tb groot maken om mee te beginnen, wat niet erg handig is. In MDBX wordt de geheugenkaartgrootte in stappen van 2Gb vergroot. Dit betekent af en toe remapping, maar resulteert in een betere gebruikerservaring.</p></li><li><p>MDBX heeft strengere controles op gelijktijdig gebruik van transactieverwerking en overlappende lees- en schrijftransacties in dezelfde thread van uitvoering. Hierdoor kunnen we sommige niet voor de hand liggende fouten opsporen en wordt het gedrag voorspelbaarder.<br> In meer dan 5 jaar (sinds het werd gescheiden van LMDB), heeft MDBX een groot aantal veiligheids- en heisenbug-fixes verzameld die, voor zover wij weten, nog steeds bestaan in LMDB. Sommige van deze problemen zijn tijdens onze tests ontdekt, en de beheerders van MDBX hebben ze serieus genomen en onmiddellijk verholpen.</p></li><li><p>Databanken die voortdurend gegevens wijzigen, creëren een aanzienlijke hoeveelheid ruimte die kan worden teruggewonnen (ook bekend als &quot;freelist&quot; in LMDB-terminologie). Wij hebben LMDB moeten patchen om de ernstigste tekortkomingen in de behandeling van reclaimable space <a href="https://github.com/ledgerwatch/erigon/wiki/LMDB-freelist-illustrated-guide" target="_blank" rel="noopener noreferrer">(analyse)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> te verhelpen. MDBX heeft <a href="https://github.com/ledgerwatch/erigon/wiki/LMDB-freelist-illustrated-guide%EF%BC%89%E3%80%82MDBX%E5%AF%B9%E5%8F%AF%E5%9B%9E%E6%94%B6%E7%A9%BA%E9%97%B4%E7%9A%84%E6%9C%89%E6%95%88%E5%A4%84%E7%90%86%E8%BF%9B%E8%A1%8C%E4%BA%86%E7%89%B9%E5%88%AB%E7%9A%84%E5%85%B3%E6%B3%A8%EF%BC%8C%E5%88%B0%E7%9B%AE%E5%89%8D%E4%B8%BA%E6%AD%A2%EF%BC%8C%E8%BF%98%E4%B8%8D%E9%9C%80%E8%A6%81%E6%89%93%E8%A1%A5%E4%B8%81%E3%80%82" target="_blank" rel="noopener noreferrer">bijzondere aandacht besteed aan de efficiënte behandeling van reclaimable space en behoefde tot dusver niet te worden gep<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a> atcht.</p></li><li><p>Op basis van onze tests presteerde MDBX iets beter op onze werklasten.</p></li><li><p>MDBX geeft meer interne telemetriegegevens vrij - meer metriek over wat er in de database gebeurt. En we hebben deze gegevens in Grafana - om betere beslissingen te nemen over het ontwerp van applicaties. Na de volledige overgang naar MDBX (waarbij de ondersteuning voor LMDB wordt verwijderd) zullen wij bijvoorbeeld een &quot;commit half full transaction&quot;-beleid invoeren om overflow/unoverflow van schijfcontacten te voorkomen. Dit zal onze code verder vereenvoudigen zonder de prestaties te beïnvloeden.</p></li><li><p>MDBX ondersteunt &quot;Exclusive open&quot; mode - wij gebruiken dit voor databankmigraties om te voorkomen dat andere readers de databank kunnen benaderen tijdens het migratieproces.</p></li></ol></blockquote><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://github.com/ledgerwatch/erigon/wiki/Criteria-for-transitioning-from-Alpha-to-Beta#switch-from-lmdb-to-mdbx" target="_blank" rel="noopener noreferrer">Erigon (de volgende generatie Ethernet client) is onlangs overgestapt van LMDB naar MDBX<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">Open in een nieuw venster</span></span></a>. <a href="#fnref1" class="footnote-backref">↩︎</a></p></li></ol></section><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Updates: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Van: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: i@rmw.link">gcxfd</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><!----><span class="next"><a href="/nl/log/2022-06-02-blake3_merkle.html" class="" aria-label="Merkleboom gebaseerd op blake3"><!--[--><!--]--> Merkleboom gebaseerd op blake3 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.2533875a.js" defer></script>
  </body>
</html>
